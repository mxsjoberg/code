<meta charset='utf-8'><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css' integrity='sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN' crossorigin='anonymous'><script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js' integrity='sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+' crossorigin='anonymous'></script><style>
        @font-face {
            font-family: "Fira Mono"; src: local("Fira Mono Regular"), url("__fonts/FiraMono-Regular.ttf");
            font-weight: normal; font-style: normal;
        }
        @font-face {
            font-family: "Fira Mono"; src: local("Fira Mono Bold"), url("__fonts/FiraMono-Bold.ttf");
            font-weight: bold; font-style: normal;
        }
        body { font-size: 16px; font-family: "Fira Mono", monospace; }
        h1 { margin: 0.5rem, 0; }
        h1 a:first-child { margin-left: 1rem; }
        h2 { margin: 0.5rem, 0; }
        p { margin: 0; }
        .row .wrapper { padding: 0.5rem 0; }
        .row .wrapper p { margin-left: 1rem; }
        a { display: inline-block; cursor: pointer; margin-right: 1rem; text-underline-position: from-font; }
        a.dotted { text-decoration-style: dotted; }
        a.dotted:hover { color: #ff1f8f; text-decoration-style: solid; }
        pre { border: 2px solid black; border-radius: 0rem; font-size: 12px; padding: 0.5rem; white-space: break-spaces; line-break: anywhere; margin: 0; scroll: none; }
        pre::-webkit-scrollbar { width: 0; }
        hr { margin: 4px 0 !important; opacity: 1; border-color: black; border-width: 2px; }
        hr.muted { margin: 4px 0 !important; opacity: 1; border-color: #b4b4b4; border-width: 1px; }
        .wrapper { margin: 0 -4px; padding-bottom: 4px; }
        .wrapper .box { padding: 0 4px; }
        .float-right { float: right; }
        div.box.focus pre { border: 2px solid #ff1f8f; }
        /* code highlight */
        .highlight .k { color: #ff1f8f !important; }
        .highlight .n { color: black !important; }
        .highlight .kn { color: black !important; }
        .highlight .s1, .highlight .si { color: #ff9800 !important; }
        .highlight .c1, .highlight .cm { color: #b4b4b4 !important; }
        .highlight .mi { color: black !important; }
        .highlight .nf, .highlight .nb { font-weight: bold; }
        .highlight .nc { color: black !important; font-weight: bold; }
    </style><script>
        document.addEventListener("DOMContentLoaded", function() {
            // add focus on link click
            document.querySelectorAll("a").forEach(function(anchor) {
                anchor.addEventListener("click", function() {
                    var anchor_name = anchor.getAttribute("href").replace("#", "");
                    var div = document.querySelector("a[name='" + anchor_name + "']").closest("div");
                    if (div) {
                        div.classList.add("focus");
                        // setTimeout(function() { div.classList.remove("focus"); }, 2000);
                    }
                });
            });
            // remove focus
            document.querySelectorAll("div.box").forEach(function(box) {
                box.addEventListener("click", function() {
                    document.querySelectorAll("div.box").forEach(function(box) { box.classList.remove("focus"); });
                });
            });
        });
    </script><div class='container-fluid mb-1'><a name='top'></a><div class='row'><div class='col'><a class='dotted' data-bs-toggle='collapse' data-bs-target='#collapseIndex' aria-expanded='false' aria-controls='collapseIndex'>&#172;</a><a class='dotted' href='#c++'>c++</a><a class='dotted' href='#python'>python</a><a class='dotted' href='#assembly'>assembly</a><a class='dotted' href='#verilog'>verilog</a><a class='dotted' href='#c'>c</a><a class='float-right' href='https://github.com/mxsjoberg/code'>Github</a></div></div><div class='row'><div class='col' style='column-count:4;'><div class='collapse' id='collapseIndex'><div class='row'><hr class='muted'></div>c++<a class='dotted' style='margin-left:12px;' href='#c++-misc'>misc</a><br><a class='dotted' href='#bubble-sort-cpp'>bubble-sort.cpp</a><br><a class='dotted' href='#math-cpp'>math.cpp</a><br><a class='dotted' href='#multithreading-cpp'>multithreading.cpp</a><br><a class='dotted' href='#namespace-cpp'>namespace.cpp</a><br><a class='dotted' href='#signals-cpp'>signals.cpp</a><br><a class='dotted' href='#smart-pointers-cpp'>smart-pointers.cpp</a><br><a class='dotted' href='#vectors-cpp'>vectors.cpp</a><br><br><div class='row'><hr class='muted'></div>c++<a class='dotted' style='margin-left:12px;' href='#c++-algos'>algos</a><br><a class='dotted' href='#binary-search-cpp'>binary-search.cpp</a><br><a class='dotted' href='#find-adjacent-cpp'>find-adjacent.cpp</a><br><a class='dotted' href='#for-each-cpp'>for-each.cpp</a><br><br><div class='row'><hr class='muted'></div>python<a class='dotted' style='margin-left:12px;' href='#python-misc'>misc</a><br><a class='dotted' href='#alu-in-python-py'>alu-in-python.py</a><br><a class='dotted' href='#bubble-sort-py'>bubble-sort.py</a><br><a class='dotted' href='#combinations-with-replacement-py'>combinations-with-replacement.py</a><br><a class='dotted' href='#composing-functions-py'>composing-functions.py</a><br><a class='dotted' href='#enumerate-py'>enumerate.py</a><br><a class='dotted' href='#erlang-b-formula-py'>erlang-b-formula.py</a><br><a class='dotted' href='#foreign-function-library-py'>foreign-function-library.py</a><br><a class='dotted' href='#function-wrappers-py'>function-wrappers.py</a><br><a class='dotted' href='#functools-cache-py'>functools-cache.py</a><br><a class='dotted' href='#glide-typing-problem-py'>glide-typing-problem.py</a><br><a class='dotted' href='#linked-list-using-recordclass-py'>linked-list-using-recordclass.py</a><br><a class='dotted' href='#numpy-operators-py'>numpy-operators.py</a><br><a class='dotted' href='#pandas-operators-py'>pandas-operators.py</a><br><a class='dotted' href='#partial-functions-py'>partial-functions.py</a><br><a class='dotted' href='#regular-expression-py'>regular-expression.py</a><br><a class='dotted' href='#sobel-filter-using-opencl-py'>sobel-filter-using-opencl.py</a><br><br><div class='row'><hr class='muted'></div>python<a class='dotted' style='margin-left:12px;' href='#python-ci'>ci</a><br><a class='dotted' href='#genetic-algorithm-optimization-py'>genetic-algorithm-optimization.py</a><br><a class='dotted' href='#particle-swarm-optimisation-py'>particle-swarm-optimisation.py</a><br><br><div class='row'><hr class='muted'></div>python<a class='dotted' style='margin-left:12px;' href='#python-ml'>ml</a><br><a class='dotted' href='#backpropagation-py'>backpropagation.py</a><br><a class='dotted' href='#convolutional-neural-network-py'>convolutional-neural-network.py</a><br><a class='dotted' href='#delta-learning-algorithm-py'>delta-learning-algorithm.py</a><br><a class='dotted' href='#gradient-descent-algorithm-py'>gradient-descent-algorithm.py</a><br><a class='dotted' href='#k-nearest-neighbors-classifier-py'>k-nearest-neighbors-classifier.py</a><br><a class='dotted' href='#linear-threshold-unit-py'>linear-threshold-unit.py</a><br><a class='dotted' href='#numpy-linear-relu-py'>numpy-linear-relu.py</a><br><a class='dotted' href='#widrow-hoff-learning-algorithm-py'>widrow-hoff-learning-algorithm.py</a><br><br><div class='row'><hr class='muted'></div>python<a class='dotted' style='margin-left:12px;' href='#python-euler'>euler</a><br><a class='dotted' href='##1-multiples-of-3-and-5-py'>#1-multiples-of-3-and-5.py</a><br><a class='dotted' href='##2-even-fibonacci-numbers-py'>#2-even-fibonacci-numbers.py</a><br><a class='dotted' href='##3-largest-prime-factor-py'>#3-largest-prime-factor.py</a><br><a class='dotted' href='##4-largest-palindrome-product-py'>#4-largest-palindrome-product.py</a><br><a class='dotted' href='##5-smallest-multiple-py'>#5-smallest-multiple.py</a><br><a class='dotted' href='##6-sum-square-difference-py'>#6-sum-square-difference.py</a><br><a class='dotted' href='##7-10001st-prime-py'>#7-10001st-prime.py</a><br><a class='dotted' href='##8-largest-product-in-a-series-py'>#8-largest-product-in-a-series.py</a><br><a class='dotted' href='##9-special-pythagorean-triplet-py'>#9-special-pythagorean-triplet.py</a><br><a class='dotted' href='##10-summation-of-primes-py'>#10-summation-of-primes.py</a><br><a class='dotted' href='##11-largest-product-in-grid-py'>#11-largest-product-in-grid.py</a><br><a class='dotted' href='##12-highly-divisible-triangular-number-py'>#12-highly-divisible-triangular-number.py</a><br><a class='dotted' href='##13-large-sum-py'>#13-large-sum.py</a><br><a class='dotted' href='##14-longest-collatz-sequence-py'>#14-longest-collatz-sequence.py</a><br><a class='dotted' href='##15-lattice-paths-py'>#15-lattice-paths.py</a><br><a class='dotted' href='##16-power-digit-sum-py'>#16-power-digit-sum.py</a><br><a class='dotted' href='##17-number-letter-counts-py'>#17-number-letter-counts.py</a><br><br><div class='row'><hr class='muted'></div>python<a class='dotted' style='margin-left:12px;' href='#python-compilers'>compilers</a><br><a class='dotted' href='#ast-constant-folding-py'>ast-constant-folding.py</a><br><a class='dotted' href='#ast-to-tac-to-llvm-py'>ast-to-tac-to-llvm.py</a><br><a class='dotted' href='#dsl-in-python-py'>dsl-in-python.py</a><br><a class='dotted' href='#for-loop-implementation-py'>for-loop-implementation.py</a><br><a class='dotted' href='#loop-tiling-optimization-py'>loop-tiling-optimization.py</a><br><a class='dotted' href='#opencl-in-python-py'>opencl-in-python.py</a><br><a class='dotted' href='#operator-fusion-on-parse-tree-py'>operator-fusion-on-parse-tree.py</a><br><a class='dotted' href='#parallelization-optimization-py'>parallelization-optimization.py</a><br><a class='dotted' href='#shunting-yard-algorithm-py'>shunting-yard-algorithm.py</a><br><a class='dotted' href='#tokenizer-using-generator-in-python-py'>tokenizer-using-generator-in-python.py</a><br><a class='dotted' href='#vectorization-optimization-py'>vectorization-optimization.py</a><br><br><div class='row'><hr class='muted'></div>assembly<a class='dotted' style='margin-left:12px;' href='#assembly-x86'>x86</a><br><a class='dotted' href='#hello-x86-asm'>hello-x86.asm</a><br><br><div class='row'><hr class='muted'></div>verilog<a class='dotted' style='margin-left:12px;' href='#verilog-misc'>misc</a><br><a class='dotted' href='#intro-v'>intro.v</a><br><br><div class='row'><hr class='muted'></div>verilog<a class='dotted' style='margin-left:12px;' href='#verilog-gates'>gates</a><br><a class='dotted' href='#and16-v'>and16.v</a><br><a class='dotted' href='#and-v'>and.v</a><br><a class='dotted' href='#dmux4way-v'>dmux4way.v</a><br><a class='dotted' href='#dmux8way-v'>dmux8way.v</a><br><a class='dotted' href='#dmux-v'>dmux.v</a><br><a class='dotted' href='#mux4way16-v'>mux4way16.v</a><br><a class='dotted' href='#mux8way16-v'>mux8way16.v</a><br><a class='dotted' href='#mux16-v'>mux16.v</a><br><a class='dotted' href='#mux-v'>mux.v</a><br><a class='dotted' href='#nand-v'>nand.v</a><br><a class='dotted' href='#not16-v'>not16.v</a><br><a class='dotted' href='#not-v'>not.v</a><br><a class='dotted' href='#or8way-v'>or8way.v</a><br><a class='dotted' href='#or16-v'>or16.v</a><br><a class='dotted' href='#or-v'>or.v</a><br><a class='dotted' href='#xor-v'>xor.v</a><br><br><div class='row'><hr class='muted'></div>c<a class='dotted' style='margin-left:12px;' href='#c-misc'>misc</a><br><a class='dotted' href='#header-files-c'>header-files.c</a><br><a class='dotted' href='#linked-list-c'>linked-list.c</a><br><a class='dotted' href='#macros-c'>macros.c</a><br><a class='dotted' href='#memory-c'>memory.c</a><br><a class='dotted' href='#pointers-c'>pointers.c</a><br><a class='dotted' href='#valist-c'>valist.c</a><br><br></div></div></div><div class='row'><hr></div><div class='row'><div class='col-12'><a name='c++'></a><h1>c++<a class='dotted' href='#c++-misc'>misc</a><a class='dotted' href='#c++-algos'>algos</a><a class='dotted float-right' href='#top'>^</a></h1><a name='c++-misc'></a><h2>misc<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#bubble-sort-cpp'>bubble-sort.cpp</a><a class='dotted' href='#math-cpp'>math.cpp</a><a class='dotted' href='#multithreading-cpp'>multithreading.cpp</a><a class='dotted' href='#namespace-cpp'>namespace.cpp</a><a class='dotted' href='#signals-cpp'>signals.cpp</a><a class='dotted' href='#smart-pointers-cpp'>smart-pointers.cpp</a><a class='dotted' href='#vectors-cpp'>vectors.cpp</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#bubble-sort-cpp'>bubble-sort.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/bubble-sort.cpp' name='bubble-sort-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">constexpr</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print_elements_in_vector</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">numbers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="c1">// print unsorted</span>
<span class="w">    </span><span class="n">print_elements_in_vector</span><span class="p">(</span><span class="n">numbers</span><span class="p">);</span><span class="w"> </span><span class="c1">// 14 33 27 35 10</span>

<span class="w">    </span><span class="c1">// bubble sort</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="p">];</span><span class="w"></span>
<span class="w">                </span><span class="c1">// swap positions</span>
<span class="w">                </span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span><span class="w"></span>
<span class="w">                </span><span class="n">numbers</span><span class="p">[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// print sorted</span>
<span class="w">    </span><span class="n">print_elements_in_vector</span><span class="p">(</span><span class="n">numbers</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10 14 27 33 35</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#math-cpp'>math.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/math.cpp' name='math-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">INFINITY</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// inf</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">NAN</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// nan</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isgreater</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isless</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isnan</span><span class="p">(</span><span class="n">NAN</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isinf</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isfinite</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>

<span class="w">    </span><span class="c1">// trigonometric</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// -0.399985</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// -0.916522</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2.29139</span>

<span class="w">    </span><span class="c1">// exponential and logarithmic</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 3</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 7.38906</span>

<span class="w">    </span><span class="c1">// binary exponential function</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">exp2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 4</span>

<span class="w">    </span><span class="c1">// natural logarithm</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2.30259</span>

<span class="w">    </span><span class="c1">// power and root</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 8</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 4</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbrt</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 3</span>

<span class="w">    </span><span class="c1">// rounding and remainder</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ceil</span><span class="p">(</span><span class="mf">41.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">floor</span><span class="p">(</span><span class="mf">42.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trunc</span><span class="p">(</span><span class="mf">42.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">round</span><span class="p">(</span><span class="mf">41.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">remainder</span><span class="p">(</span><span class="mi">142</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>

<span class="w">    </span><span class="c1">// round to nearest integer</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">rint</span><span class="p">(</span><span class="mf">42.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>

<span class="w">    </span><span class="c1">// round to nearby integer</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">nearbyint</span><span class="p">(</span><span class="mf">42.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>

<span class="w">    </span><span class="c1">// manipulation</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">copysign</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// -42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">nan</span><span class="p">(</span><span class="s">"42"</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// nan</span>

<span class="w">    </span><span class="c1">// minimum, maximum, difference</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fdim</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fmax</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fmin</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 10</span>

<span class="w">    </span><span class="c1">// absolute value (can handle floating-point)</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fabs</span><span class="p">(</span><span class="mf">-12.5</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 12.5</span>

<span class="w">    </span><span class="c1">// absolute value (only for integers)</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="mi">-42</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 42</span>

<span class="w">    </span><span class="c1">// fused multiply-add</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">fma</span><span class="p">(</span><span class="mf">42.5</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 625</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#multithreading-cpp'>multithreading.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/multithreading.cpp' name='multithreading-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">max_threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">print</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">thread_id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">thread_id</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"thread_id: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">tid</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// terminate</span>
<span class="w">    </span><span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">threads</span><span class="p">[</span><span class="n">max_threads</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="kr">thread</span><span class="p">[</span><span class="n">max_threads</span><span class="p">];</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_threads</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kr">thread</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"creating thread:"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kr">thread</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// create thread using pthread_create(thread, attr, start_routine, arg)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">print</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="kr">thread</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"unable to create thread: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kr">thread</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// fail</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// terminate</span>
<span class="w">    </span><span class="n">pthread_exit</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// creating thread:0</span>
<span class="w">    </span><span class="c1">// creating thread:1</span>
<span class="w">    </span><span class="c1">// thread_id: 140701949382784</span>
<span class="w">    </span><span class="c1">// thread_id: 140701949382788</span>
<span class="w">    </span><span class="c1">// creating thread:2</span>
<span class="w">    </span><span class="c1">// creating thread:3</span>
<span class="w">    </span><span class="c1">// thread_id: 140701949382792</span>
<span class="w">    </span><span class="c1">// creating thread:4</span>
<span class="w">    </span><span class="c1">// thread_id: 140701949382796</span>
<span class="w">    </span><span class="c1">// thread_id: 140701949382800</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#namespace-cpp'>namespace.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/namespace.cpp' name='namespace-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="c1">// define namespace</span>
<span class="k">namespace</span><span class="w"> </span><span class="nn">my_functions</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"called: my_functions::function"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">my_functions</span><span class="o">::</span><span class="n">function</span><span class="p">();</span><span class="w"> </span><span class="c1">// called: my_functions::function</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#signals-cpp'>signals.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/signals.cpp' name='signals-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;csignal&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>

<span class="c1">// signal handler</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">terminate</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">signal: "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sig</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">exit</span><span class="p">(</span><span class="n">sig</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="c1">// register signal</span>
<span class="w">   </span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">terminate</span><span class="p">);</span><span class="w">  </span>

<span class="w">   </span><span class="c1">// keyboard interrupt</span>
<span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"stuck doing something really hard... (press ^C to exit)"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="c1">// stuck doing something really hard... (press ^C to exit)</span>
<span class="w">   </span><span class="c1">// ^C</span>
<span class="w">   </span><span class="c1">// signal: 2</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#smart-pointers-cpp'>smart-pointers.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/smart-pointers.cpp' name='smart-pointers-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1">// smart pointers handle allocation and deletion of memory</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="c1">// unique_ptr is a smart pointer</span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="n">MyClass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// allocate memory with make_unique</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print_data</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">function_using_data</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">MyClass</span><span class="w"> </span><span class="n">my_class</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// lifetime tied to scope</span>
<span class="w">    </span><span class="n">my_class</span><span class="p">.</span><span class="n">print_data</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="c1">// my_class is destroyed here</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">function_using_data</span><span class="p">();</span><span class="w"> </span><span class="c1">// 0 0 0 0 0</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#vectors-cpp'>vectors.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/misc/vectors.cpp' name='vectors-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;format&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// vector of ints</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// size</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">    </span><span class="c1">// push values</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">numbers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 5</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">numbers</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 4</span>

<span class="w">    </span><span class="c1">// vector of strings</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">strings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"hello"</span><span class="p">,</span><span class="w"> </span><span class="s">"c++"</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">strings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">strings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// hello c++</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div></div></div><a name='c++-algos'></a><h2>algos<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#binary-search-cpp'>binary-search.cpp</a><a class='dotted' href='#find-adjacent-cpp'>find-adjacent.cpp</a><a class='dotted' href='#for-each-cpp'>for-each.cpp</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#binary-search-cpp'>binary-search.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/algos/binary-search.cpp' name='binary-search-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="c1">// binary_search</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">binary_search</span><span class="p">(</span><span class="n">numbers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"found value"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"not found"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// found value</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#find-adjacent-cpp'>find-adjacent.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/algos/find-adjacent.cpp' name='find-adjacent-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">bool</span><span class="w"> </span><span class="nf">twice</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="c1">// adjacent_find</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">adjacent_find</span><span class="p">(</span><span class="n">numbers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">twice</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">iter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"no adjacent pairs"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 10, 20</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#for-each-cpp'>for-each.cpp</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c++/algos/for-each.cpp' name='for-each-cpp' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="c1">// multiply each element in numbers using for_each</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">numbers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">number</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="c1">// for_each</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">numbers</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 2 4 6 8 10</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div></div></div></div></div><div class='row'><hr></div><div class='row'><div class='col-12'><a name='python'></a><h1>python<a class='dotted' href='#python-misc'>misc</a><a class='dotted' href='#python-ci'>ci</a><a class='dotted' href='#python-ml'>ml</a><a class='dotted' href='#python-euler'>euler</a><a class='dotted' href='#python-compilers'>compilers</a><a class='dotted float-right' href='#top'>^</a></h1><a name='python-misc'></a><h2>misc<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#alu-in-python-py'>alu-in-python.py</a><a class='dotted' href='#bubble-sort-py'>bubble-sort.py</a><a class='dotted' href='#combinations-with-replacement-py'>combinations-with-replacement.py</a><a class='dotted' href='#composing-functions-py'>composing-functions.py</a><a class='dotted' href='#enumerate-py'>enumerate.py</a><a class='dotted' href='#erlang-b-formula-py'>erlang-b-formula.py</a><a class='dotted' href='#foreign-function-library-py'>foreign-function-library.py</a><a class='dotted' href='#function-wrappers-py'>function-wrappers.py</a><a class='dotted' href='#functools-cache-py'>functools-cache.py</a><a class='dotted' href='#glide-typing-problem-py'>glide-typing-problem.py</a><a class='dotted' href='#linked-list-using-recordclass-py'>linked-list-using-recordclass.py</a><a class='dotted' href='#numpy-operators-py'>numpy-operators.py</a><a class='dotted' href='#pandas-operators-py'>pandas-operators.py</a><a class='dotted' href='#partial-functions-py'>partial-functions.py</a><a class='dotted' href='#regular-expression-py'>regular-expression.py</a><a class='dotted' href='#sobel-filter-using-opencl-py'>sobel-filter-using-opencl.py</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#alu-in-python-py'>alu-in-python.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/alu-in-python.py' name='alu-in-python-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">An ALU is a combinational logic circuit that performs</span>
<span class="sd">arithmetic and bitwise operations on input bits. This</span>
<span class="sd">is a 16-bit implementation.</span>
<span class="sd">"""</span>

<span class="c1"># binary to signed decimal</span>
<span class="k">def</span> <span class="nf">binary_to_signed</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="n">binary_str</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">lst</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">binary_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">):</span>
        <span class="c1"># invert bits</span>
        <span class="n">inverted_str</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">'1'</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">'0'</span> <span class="k">else</span> <span class="s1">'0'</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">binary_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="n">decimal</span> <span class="o">=</span> <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">inverted_str</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">decimal</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">binary_str</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decimal</span>

<span class="k">assert</span> <span class="n">binary_to_signed</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># https://en.wikipedia.org/wiki/Two%27s_complement</span>
<span class="k">def</span> <span class="nf">twos_complement_addition</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># convert to binary strings</span>
    <span class="n">a_bin</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
    <span class="n">b_bin</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="c1"># number of bits</span>
    <span class="n">bits</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a_bin</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_bin</span><span class="p">))</span>
    <span class="c1"># convert to twos complement</span>
    <span class="n">a_twos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a_bin</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">b_twos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_bin</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># addition</span>
    <span class="n">result_twos</span> <span class="o">=</span> <span class="n">a_twos</span> <span class="o">+</span> <span class="n">b_twos</span>
    <span class="c1"># convert result to binary string</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">result_twos</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">bits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1"># convert result to list of ints</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
    <span class="c1"># padding (if needed)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bits</span><span class="p">):</span>
        <span class="c1"># insert 0s to front</span>
        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bits</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)):</span> <span class="n">result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

<span class="k">assert</span> <span class="n">twos_complement_addition</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="sd">"""</span>
<span class="sd">if (zx == 1)  set x = 0           : 16-bit</span>
<span class="sd">if (nx == 1)  set x = ~x          : 16-bit bitwise not</span>
<span class="sd">if (zy == 1)  set y = 0           : 16-bit constant</span>
<span class="sd">if (ny == 1)  set y = ~y          : 16-bit bitwise not</span>
<span class="sd">if (f == 1)   set out = x + y     : 16-bit twos complement addition</span>
<span class="sd">if (f == 0)   set out = x &amp; y     : 16-bit bitwise and</span>
<span class="sd">if (no == 1)  set out = ~out      : 16-bit bitwise not</span>
<span class="sd">if (out == 0) set zr = 1          : 1-bit</span>
<span class="sd">if (out &lt; 0)  set ng = 1          : 1-bit</span>
<span class="sd">"""</span>
<span class="k">def</span> <span class="nf">ALU</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">        x   : input x       : 16-bit</span>
<span class="sd">        y   : input y       : 16-bit</span>
<span class="sd">        zx  : zero x        : 1-bit</span>
<span class="sd">        nx  : negate x      : 1-bit</span>
<span class="sd">        zy  : zero y        : 1-bit</span>
<span class="sd">        ny  : negate y      : 1-bit</span>
<span class="sd">        f   : function      : 1-bit</span>
<span class="sd">        no  : negate out    : 1-bit</span>
<span class="sd">    """</span>
    <span class="c1"># init output</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">zr</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">ng</span><span class="o">=</span><span class="mi">0</span>
    <span class="c1"># if (zx == 1)  set x = 0</span>
    <span class="k">if</span> <span class="n">zx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># if (nx == 1)  set x = ~x</span>
    <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># if (zy == 1)  set y = 0</span>
    <span class="k">if</span> <span class="n">zy</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># if (ny == 1)  set y = ~y</span>
    <span class="k">if</span> <span class="n">ny</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># if (f == 1)   set out = x + y</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">out</span> <span class="o">=</span> <span class="n">twos_complement_addition</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="c1"># if (f == 0)   set out = x &amp; y</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># if (no == 1)  set out = ~out</span>
    <span class="k">if</span> <span class="n">no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># if (out == 0) set zr = 1</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">bit</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">out</span><span class="p">):</span> <span class="n">zr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># if (out &lt; 0)  set ng = 1</span>
    <span class="k">if</span> <span class="n">binary_to_signed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ng</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">zr</span><span class="p">,</span> <span class="n">ng</span>

<span class="c1"># test cases</span>

<span class="sd">"""</span>
<span class="sd">|       x        |       y        |zx|nx|zy|ny|f|no|      out       |zr|ng|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 0| 1| 0|1| 0|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 1| 1|1| 1|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 1| 0|1| 0|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 1| 1|0| 0|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 0| 0|0| 0|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 1| 1|0| 1|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 0| 0|0| 1|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 1| 1|1| 1|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 0| 0|1| 1|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 1| 1| 1|1| 1|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 0| 1|1| 1|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 1| 1|1| 0|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 1| 1| 0| 0|1| 0|1111111111111110| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 0| 0|1| 0|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 1| 0| 0|1| 1|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 0| 1|1| 1|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 0| 0| 0|0| 0|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000000000|1111111111111111| 0| 1| 0| 1|0| 1|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 0| 1| 0|1| 0|0000000000000000| 1| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 1| 1|1| 1|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 1| 0|1| 0|1111111111111111| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 1| 1|0| 0|0000000000010001| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 0| 0|0| 0|0000000000000011| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 1| 1|0| 1|1111111111101110| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 0| 0|0| 1|1111111111111100| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 1| 1|1| 1|1111111111101111| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 0| 0|1| 1|1111111111111101| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 1| 1| 1|1| 1|0000000000010010| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 0| 1|1| 1|0000000000000100| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 1| 1|1| 0|0000000000010000| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 1| 1| 0| 0|1| 0|0000000000000010| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 0| 0|1| 0|0000000000010100| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 1| 0| 0|1| 1|0000000000001110| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 0| 1|1| 1|1111111111110010| 0| 1|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 0| 0| 0|0| 0|0000000000000001| 0| 0|</span>
<span class="sd">|0000000000010001|0000000000000011| 0| 1| 0| 1|0| 1|0000000000010011| 0| 0|</span>
<span class="sd">"""</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"_alu_tests.txt"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">tests</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">test</span><span class="p">]</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">zr</span><span class="p">,</span> <span class="n">ng</span> <span class="o">=</span> <span class="n">ALU</span><span class="p">(</span>
            <span class="c1"># input x</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))),</span>
            <span class="c1"># input y</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]))),</span>
            <span class="c1"># control bits</span>
            <span class="n">zx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">nx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="n">zy</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
            <span class="n">ny</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
            <span class="n">f</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
            <span class="n">no</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">out</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">8</span><span class="p">])))</span>
        <span class="k">assert</span> <span class="n">zr</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="k">assert</span> <span class="n">ng</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#bubble-sort-py'>bubble-sort.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/bubble-sort.py' name='bubble-sort-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Bubble_sort</span>

<span class="n">unsorted_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unsorted_list</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unsorted_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># swap</span>
            <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">unsorted_list</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

<span class="nb">print</span><span class="p">(</span><span class="n">unsorted_list</span><span class="p">)</span> <span class="c1"># [10, 14, 27, 33, 35]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#combinations-with-replacement-py'>combinations-with-replacement.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/combinations-with-replacement.py' name='combinations-with-replacement-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations_with_replacement</span>

<span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'B'</span><span class="p">]</span>
<span class="n">combinations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_list</span><span class="p">))):</span>
    <span class="n">combinations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combinations_with_replacement</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="n">item</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span>
<span class="c1"># [[('A',), ('B',)], [('A', 'A'), ('A', 'B'), ('B', 'B')]]</span>

<span class="c1"># flatten</span>
<span class="n">combinations</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">combinations</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combinations</span><span class="p">)</span>
<span class="c1"># [('A',), ('B',), ('A', 'A'), ('A', 'B'), ('B', 'B')]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#composing-functions-py'>composing-functions.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/composing-functions.py' name='composing-functions-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>

<span class="c1"># double then square</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c1"># 100</span>

<span class="c1"># passing operator as argument</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">numbers</span><span class="p">))</span> <span class="c1"># 15</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#enumerate-py'>enumerate.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/enumerate.py' name='enumerate-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Zero"</span><span class="p">,</span> <span class="s2">"One"</span><span class="p">,</span> <span class="s2">"Two"</span><span class="p">,</span> <span class="s2">"Three"</span><span class="p">,</span> <span class="s2">"Four"</span><span class="p">,</span> <span class="s2">"Five"</span><span class="p">]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">my_list</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c1"># (0, 'First')</span>
<span class="c1"># (1, 'Second')</span>
<span class="c1"># (2, 'Third')</span>
<span class="c1"># (3, 'Fourth')</span>
<span class="c1"># (4, 'Fifth')</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#erlang-b-formula-py'>erlang-b-formula.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/erlang-b-formula.py' name='erlang-b-formula-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Erlang_(unit)#Erlang_B_formula</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>

<span class="k">def</span> <span class="nf">erlang</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">sum_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> <span class="n">sum_</span> <span class="o">+=</span> <span class="p">(</span><span class="n">A</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">L</span> <span class="o">/</span> <span class="n">sum_</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">erlang</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">107</span><span class="p">))</span> <span class="c1"># 0.008799105244742682</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#foreign-function-library-py'>foreign-function-library.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/foreign-function-library.py' name='foreign-function-library-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">A foreign function library is a library written in</span>
<span class="sd">languages other than the language it is being called</span>
<span class="sd">from. E.g., a Python program calling function from C</span>
<span class="sd">library.</span>
<span class="sd">"""</span>

<span class="sd">"""</span>
<span class="sd">// _square.c</span>
<span class="sd">#include &lt;stdio.h&gt;</span>

<span class="sd">int square(int num) {</span>
<span class="sd">    return num * num;</span>
<span class="sd">}</span>
<span class="sd">// compile into shared library:</span>
<span class="sd">// $ gcc -shared -o _square.so -fPIC _square.c</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="c1"># load the shared library</span>
<span class="n">square_lib</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">'./_square.so'</span><span class="p">)</span>

<span class="c1"># specify function return and argument types</span>
<span class="n">square_lib</span><span class="o">.</span><span class="n">square</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
<span class="n">square_lib</span><span class="o">.</span><span class="n">square</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">]</span>

<span class="c1"># call the foreign function</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">square_lib</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"the square of </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="c1"># the square of 5 is 25</span>

<span class="c1"># using C standard library functions</span>
<span class="c1"># https://gist.github.com/PewZ/8b473c2a6888c5c528635550d07c6186</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">'libc.dylib'</span><span class="p">)</span>
<span class="n">libc</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="sa">b</span><span class="s2">"hello world</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span> <span class="c1"># hello world</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#function-wrappers-py'>function-wrappers.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/function-wrappers.py' name='function-wrappers-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Function wrappers can be used to modify behavior of function</span>
<span class="sd">or method. The wraps decorator copies over the function name,</span>
<span class="sd">docstring, and arguments list to the wrapper function. This</span>
<span class="sd">is very useful for debugging and logging.</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">logging</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"call to </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@logging</span>
<span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span> <span class="k">return</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exp</span>

<span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># call to power, args: (2, 3), kwargs: {}</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#functools-cache-py'>functools-cache.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/functools-cache.py' name='functools-cache-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">The lru_cache decorator caches the results of a function</span>
<span class="sd">call with a given set of arguments. This is useful for</span>
<span class="sd">functions that are computationally expensive and have a</span>
<span class="sd">limited set of arguments.</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># fibonacci with cache</span>
<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fib_cache</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">fib_cache</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib_cache</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'fib(30)'</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'.17f'</span><span class="p">))</span>
<span class="c1"># 0.12468479387462139</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'fib_cache(30)'</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s1">'.17f'</span><span class="p">))</span>
<span class="c1"># 0.00001071766018867</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fib_cache</span><span class="o">.</span><span class="n">cache_info</span><span class="p">())</span>
<span class="c1"># CacheInfo(hits=28, misses=31, maxsize=128, currsize=31)</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#glide-typing-problem-py'>glide-typing-problem.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/glide-typing-problem.py' name='glide-typing-problem-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Glide typing is the feature on mobile devices that allows</span>
<span class="sd">users to type by swiping across the keyboard. The keyboard</span>
<span class="sd">will predict the word based on the path of the swipe.</span>
<span class="sd">"""</span>

<span class="n">input_</span> <span class="o">=</span> <span class="s2">"hgferyjkllkop"</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"coffee"</span><span class="p">,</span> <span class="s2">"coding"</span><span class="p">,</span> <span class="s2">"happy"</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">,</span> <span class="s2">"hop"</span><span class="p">]</span>
<span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_</span><span class="p">)</span>

<span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">col</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">chars</span><span class="p">):</span>
        <span class="c1"># print(chars[col], col)</span>
        <span class="k">if</span> <span class="n">chars</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">==</span> <span class="n">word</span><span class="p">[</span><span class="n">cidx</span><span class="p">]:</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
                <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">word</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                <span class="k">break</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># all matches</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="c1"># [('hello', 11), ('hop', 12)]</span>

<span class="c1"># first match</span>
<span class="nb">print</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># hello</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#linked-list-using-recordclass-py'>linked-list-using-recordclass.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/linked-list-using-recordclass.py' name='linked-list-using-recordclass-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">A linked list is a linear data structure where each element</span>
<span class="sd">is the data and reference to next element. The last element</span>
<span class="sd">reference to None and an empty linked list has a None head.</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">recordclass</span> <span class="kn">import</span> <span class="n">recordclass</span>

<span class="c1"># recordclass is a mutable namedtuple</span>
<span class="n">Element</span> <span class="o">=</span> <span class="n">recordclass</span><span class="p">(</span><span class="s2">"Element"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"value"</span><span class="p">,</span> <span class="s2">"next"</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">LinkedList</span><span class="p">:</span>
    <span class="c1"># linked list constructor</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># string representation of linked list</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="s2">"[]"</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">current</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># insert element at tail</span>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># insert at head</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span>
            <span class="c1"># iterate until last element</span>
            <span class="k">while</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span>
            <span class="c1"># insert element</span>
            <span class="n">current</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># remove element</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="c1"># remove head</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">next</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span>
            <span class="c1"># iterate until last element</span>
            <span class="k">while</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># remove element if found</span>
                <span class="k">if</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">current</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">next</span>
                    <span class="k">return</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span>

<span class="n">ll</span> <span class="o">=</span> <span class="n">LinkedList</span><span class="p">()</span>

<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="c1"># [5, 10, 15, 20, 25, 30]</span>

<span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span> <span class="c1"># [5, 10, 20, 25]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#numpy-operators-py'>numpy-operators.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/numpy-operators.py' name='numpy-operators-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># numpy array basics</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">81</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">55</span><span class="p">,</span> <span class="mi">634</span><span class="p">,</span> <span class="mi">704</span><span class="p">,</span> <span class="mi">2020</span><span class="p">]</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">'i'</span><span class="p">)</span> <span class="c1"># [60 28 49 81]</span>

<span class="n">AB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
<span class="c1"># [[  60   28   49   81]</span>
<span class="c1">#  [  55  634  704 2020]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span> <span class="c1"># 2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># (2, 4)</span>

<span class="n">arr_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># [0. 0. 0. 0.]</span>

<span class="n">arr_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># [[ 1.  1.  1.]</span>
<span class="c1">#  [ 1.  1.  1.]]</span>

<span class="n">arr_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># [0 1 2 3 4 5 6 7 8 9]</span>

<span class="n">arr_linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1"># [0.   0.25 0.5  0.75 1.  ]</span>

<span class="n">arr_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1"># [ 1.          1.77827941  3.16227766  5.62341325 10.        ]</span>

<span class="c1"># slicing</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="c1"># [28 49]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AB</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
<span class="c1"># [[  49   81]</span>
<span class="c1">#  [ 704 2020]]</span>

<span class="c1"># reverse order</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># [81 49 28 60]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">arr_range</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="c1"># 4.5</span>
<span class="nb">print</span><span class="p">(</span><span class="n">arr_range</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="c1"># 45</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="c1"># 28</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AB</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="c1"># 2020</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">AB</span><span class="p">))</span>
<span class="c1"># [[-0.30481062  0.27090579 -0.95375265 -0.62988799]</span>
<span class="c1">#  [-0.99975517 -0.56605794  0.27947339  0.04406199]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="c1"># [  3300  17752  34496 163620]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="c1"># [ 7.41619849 25.17935662 26.53299832 44.94441011]</span>

<span class="c1"># min value in each column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span> <span class="c1"># [55 28 49 81]</span>

<span class="c1"># sum of axis (columns)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">AB</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># [ 218 3413]</span>

<span class="c1"># numpy indexing</span>

<span class="c1"># create array with 8 integers</span>
<span class="n">A</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1"># [ 1  3  9 19 33 51 73 99]</span>

<span class="c1"># create array with 16 integers</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># [[ 0  1  2  3]</span>
<span class="c1">#  [ 4  5  6  7]</span>
<span class="c1">#  [ 8  9 10 11]</span>
<span class="c1">#  [12 13 14 15]]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="c1"># [19 99  3]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="c1"># [[ 2  3  0]</span>
<span class="c1">#  [ 6  7  4]</span>
<span class="c1">#  [10 11  8]</span>
<span class="c1">#  [14 15 12]]</span>

<span class="c1"># elements from A at indices given by fibonacci sequence</span>
<span class="n">fibseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">fibseq</span><span class="p">])</span> <span class="c1"># [ 1  3  3  9 19]</span>

<span class="c1"># diagonal</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="c1"># [ 0  5 10 15]</span>

<span class="c1"># diagonal of part</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">i</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="c1"># [ 1  6 11]</span>

<span class="c1"># numpy masking</span>

<span class="c1"># create array with 16 integers</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># [[ 0  1  2  3]</span>
<span class="c1">#  [ 4  5  6  7]</span>
<span class="c1">#  [ 8  9 10 11]</span>
<span class="c1">#  [12 13 14 15]]</span>

<span class="c1"># create mask with True</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="c1"># [ True  True  True  True]</span>

<span class="c1"># diagonal</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">])</span> <span class="c1"># [ 0  5 10 15]</span>

<span class="c1"># conditional mask</span>
<span class="n">conditional</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">conditional</span><span class="p">])</span> <span class="c1"># [ 9 10 11 12 13 14 15]</span>

<span class="c1"># get all values smaller than 9</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">C</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">])</span> <span class="c1"># [0 1 2 3 4 5 6 7 8]</span>

<span class="c1"># get all values smaller than 5 or larger than 10</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[(</span><span class="n">C</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">C</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)])</span>
<span class="c1"># [ 0  1  2  3  4 11 12 13 14 15]</span>

<span class="c1"># where</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">C</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)])</span> <span class="c1"># [11 12 13 14 15]</span>

<span class="c1"># get all columns with a value less than 3</span>
<span class="nb">print</span><span class="p">(</span><span class="n">C</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">C</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
<span class="c1"># [[ 0  1  2]</span>
<span class="c1">#  [ 4  5  6]</span>
<span class="c1">#  [ 8  9 10]</span>
<span class="c1">#  [12 13 14]]</span>

<span class="c1"># numpy operations</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c1"># [0 1 2 3 4 5]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span> <span class="c1"># [ 0  2  4  6  8 10]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># [-1  0  1  2  3  4]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="c1"># [ 0  6 12 18 24 30]</span>

<span class="c1"># gradient</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="c1"># [ 2.   1.5  1. ] =&gt; (4 - 2) / 1, (5 - 2) / 2, (5 - 4)/ 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="c1"># [-4.  1.  6.] =&gt; (2 - 6) / 1, (8 - 6) / 2, (8 - 2)/ 1</span>

<span class="c1"># numerical derivative</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<span class="c1"># [-2.          0.66666667  6.        ]</span>

<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># [[0 1]</span>
<span class="c1">#  [2 3]]</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">],[</span><span class="mi">4</span><span class="p">]])</span>
<span class="c1"># [[2]</span>
<span class="c1">#  [4]]</span>

<span class="c1"># scalar (multiplication)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span>
<span class="c1"># [[ 0  2]</span>
<span class="c1">#  [ 8 12]]</span>

<span class="c1"># dot product</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
<span class="c1"># [[ 4]</span>
<span class="c1">#  [16]]</span>

<span class="c1"># operations on higher dimensions</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">M</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1"># [[ 0  1  2]</span>
<span class="c1">#  [ 3  4  5]</span>
<span class="c1">#  [ 6  7  8]</span>
<span class="c1">#  [ 9 10 11]]</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
<span class="c1"># [[16 18 20]</span>
<span class="c1">#  [19 21 23]</span>
<span class="c1">#  [22 24 26]</span>
<span class="c1">#  [25 27 29]]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#pandas-operators-py'>pandas-operators.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/pandas-operators.py' name='pandas-operators-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># creating series (one-dimensional array)</span>
<span class="n">simple_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">42</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">73</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">'f8'</span><span class="p">)</span>
<span class="c1"># 0     42.0</span>
<span class="c1"># 1     55.0</span>
<span class="c1"># 2     73.0</span>
<span class="c1"># dtype: float64</span>

<span class="c1"># creating series with specified index</span>
<span class="n">index_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">42</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">73</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"electron"</span><span class="p">,</span> <span class="s2">"proton"</span><span class="p">,</span> <span class="s2">"neutron"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">'f8'</span><span class="p">)</span>
<span class="c1"># electron      42.0</span>
<span class="c1"># proton        55.0</span>
<span class="c1"># neutron       73.0</span>
<span class="c1"># dtype: float64</span>

<span class="c1"># accessing value in series</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index_series</span><span class="p">[</span><span class="s2">"electron"</span><span class="p">])</span>
<span class="c1"># 42.0</span>

<span class="c1"># accessing multiple values in series (range)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index_series</span><span class="p">[</span><span class="s2">"electron"</span><span class="p">:</span><span class="s2">"neutron"</span><span class="p">])</span>
<span class="c1"># electron      42.0</span>
<span class="c1"># proton        55.0</span>
<span class="c1"># neutron       73.0</span>
<span class="c1"># dtype: float64</span>

<span class="c1"># accessing multiple values in series using indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index_series</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="c1"># proton        55.0</span>
<span class="c1"># neutron       73.0</span>
<span class="c1"># dtype: float64</span>

<span class="c1"># creating series from dictionary</span>
<span class="n">dict_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span> <span class="s2">"electron"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"neutron"</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="s2">"proton"</span><span class="p">:</span> <span class="mi">496</span><span class="p">,</span> <span class="s2">"neutrino"</span><span class="p">:</span> <span class="mi">8128</span> <span class="p">})</span>
<span class="c1"># electron      6</span>
<span class="c1"># neutrino      8128</span>
<span class="c1"># neutron       28</span>
<span class="c1"># proton        496</span>
<span class="c1"># dtype: int64</span>

<span class="c1"># combining two series into one column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index_series</span> <span class="o">+</span> <span class="n">dict_series</span><span class="p">)</span>
<span class="c1"># electron      48.0</span>
<span class="c1"># neutrino      NaN</span>
<span class="c1"># neutron       101.0</span>
<span class="c1"># proton        551.0</span>
<span class="c1"># dtype: float64</span>

<span class="c1"># combining two series as dataframe</span>
<span class="n">combined_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s2">"A"</span><span class="p">:</span> <span class="n">index_series</span><span class="p">,</span> <span class="s2">"B"</span><span class="p">:</span> <span class="n">dict_series</span> <span class="p">})</span>
<span class="c1">#               A       B</span>
<span class="c1"># electron      42.0    6</span>
<span class="c1"># neutrino      NaN     8128</span>
<span class="c1"># neutron       73.0    28</span>
<span class="c1"># proton        55.0    496</span>

<span class="c1"># accessing columns as series</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_series</span><span class="p">[</span><span class="s2">"A"</span><span class="p">])</span>
<span class="c1"># electron      42.0</span>
<span class="c1"># neutrino      NaN</span>
<span class="c1"># neutron       73.0</span>
<span class="c1"># proton        55.0</span>
<span class="c1"># Name: A, dtype: float64</span>

<span class="c1"># add new row with index</span>
<span class="n">append_series</span> <span class="o">=</span> <span class="n">combined_series</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s2">"A"</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">8128</span><span class="p">]</span> <span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">"antineutrino"</span><span class="p">]))</span>
<span class="c1">#               A       B</span>
<span class="c1"># electron      42.0    6.0</span>
<span class="c1"># neutrino      NaN     8128.0</span>
<span class="c1"># neutron       73.0    28.0</span>
<span class="c1"># proton        55.0    496.0</span>
<span class="c1"># antineutrino  -8128.0 NaN</span>

<span class="c1"># drop row</span>
<span class="n">append_series</span> <span class="o">=</span> <span class="n">append_series</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">"neutron"</span><span class="p">)</span>
<span class="c1">#               A       B</span>
<span class="c1"># electron      42.0    6.0</span>
<span class="c1"># neutrino      NaN     8128.0</span>
<span class="c1"># proton        55.0    496.0</span>
<span class="c1"># antineutrino  -8128.0 NaN</span>

<span class="c1"># transpose</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_series</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="c1">#       electron    neutrino    neutron     proton</span>
<span class="c1"># A     42.0        NaN         73.0        55.0</span>
<span class="c1"># B     6.0         8128.0      28.0        496.0</span>

<span class="c1"># masking</span>
<span class="nb">print</span><span class="p">(</span><span class="n">combined_series</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>
<span class="c1">#               A       B</span>
<span class="c1"># electron      False   False</span>
<span class="c1"># neutrino      False   True</span>
<span class="c1"># neutron       False   False</span>
<span class="c1"># proton        False   True</span>

<span class="c1"># add masking as column (e.g. larger than 120)</span>
<span class="n">combined_series</span><span class="p">[</span><span class="s2">"large"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">combined_series</span><span class="p">[</span><span class="s2">"A"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">combined_series</span><span class="p">[</span><span class="s2">"B"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>
<span class="c1">#               A       B       large</span>
<span class="c1"># electron      42.0    6       False</span>
<span class="c1"># neutrino      NaN     8128    True</span>
<span class="c1"># neutron       73.0    28      False</span>
<span class="c1"># proton        55.0    496     True</span>

<span class="c1"># delete a column</span>
<span class="k">del</span> <span class="n">combined_series</span><span class="p">[</span><span class="s2">"large"</span><span class="p">]</span>
<span class="c1">#               A       B</span>
<span class="c1"># electron      42.0    6</span>
<span class="c1"># neutrino      NaN     8128</span>
<span class="c1"># neutron       73.0    28</span>
<span class="c1"># proton        55.0    496</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#partial-functions-py'>partial-functions.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/partial-functions.py' name='partial-functions-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">A partial function is a function with some arguments already</span>
<span class="sd">filled in. This is useful for creating new functions from</span>
<span class="sd">existing functions.</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span> <span class="k">return</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exp</span>

<span class="c1"># partial functions</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">square</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># 4</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># 8</span>

<span class="c1"># partial functions with map</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)))</span>
<span class="c1"># [1, 4, 9, 16, 25]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">cube</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)))</span>
<span class="c1"># [1, 8, 27, 64, 125]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#regular-expression-py'>regular-expression.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/regular-expression.py' name='regular-expression-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">"some random text to test regular expressions"</span>
<span class="n">date</span> <span class="o">=</span> <span class="s2">"2017-07-16"</span>

<span class="c1"># create pattern -&gt; four letter word ending with "st"</span>
<span class="n">pattern_text</span> <span class="o">=</span> <span class="s2">"..st"</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern_text</span><span class="p">)</span>

<span class="c1"># search for pattern in text</span>
<span class="n">re_search</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">re_search</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">re_search</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> <span class="c1"># test</span>

<span class="c1"># separate text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
<span class="c1"># ['some random text to ', ' regular expressions']</span>

<span class="c1"># substitute word in text</span>
<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s2">"learn"</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># some random text to learn regular expressions</span>

<span class="c1"># match</span>
<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">"20[01][0-9].*[0-9][0-9].*[0-9][0-9]"</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span>
<span class="c1"># True</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#sobel-filter-using-opencl-py'>sobel-filter-using-opencl.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/misc/sobel-filter-using-opencl.py' name='sobel-filter-using-opencl-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">A Sobel filter is an edge detection filter. It's a 3x3</span>
<span class="sd">convolution commonly used in image processing.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyopencl</span> <span class="k">as</span> <span class="nn">cl</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageFilter</span>

<span class="c1"># load image</span>
<span class="n">input_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'_images/photo.png'</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'L'</span><span class="p">)</span>
<span class="n">input_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="c1"># input_image.show()</span>

<span class="c1"># sobel kernel</span>
<span class="c1"># sobel_x_kernel = np.array([[-1, 0, 1], [-2, 0, 2], [-1, 0, 1]]).astype(np.float32)</span>
<span class="c1"># sobel_y_kernel = np.array([[-1, -2, -1], [0, 0, 0], [1, 2, 1]]).astype(np.float32)</span>

<span class="c1"># opencl</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get_platforms</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">get_devices</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># AMD Radeon Pro 5500M Compute Engine</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Context</span><span class="p">([</span><span class="n">device</span><span class="p">])</span>
<span class="n">queue</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">CommandQueue</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

<span class="c1"># buffers</span>
<span class="n">input_buffer</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">READ_ONLY</span> <span class="o">|</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">COPY_HOST_PTR</span><span class="p">,</span> <span class="n">hostbuf</span><span class="o">=</span><span class="n">input_array</span><span class="p">)</span>
<span class="n">output_buffer</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">WRITE_ONLY</span><span class="p">,</span> <span class="n">input_array</span><span class="o">.</span><span class="n">nbytes</span><span class="p">)</span>

<span class="c1"># compile kernel</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Program</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s2">"""</span>
<span class="s2">    __kernel void sobel_filter(__global const uchar* input, __global uchar* output, const int width, const int height) {</span>
<span class="s2">        int x = get_global_id(0);</span>
<span class="s2">        int y = get_global_id(1);</span>

<span class="s2">        if (x &gt; 0 &amp;&amp; x &lt; width - 1 &amp;&amp; y &gt; 0 &amp;&amp; y &lt; height - 1) {</span>
<span class="s2">            float sum_x = 0;</span>
<span class="s2">            float sum_y = 0;</span>

<span class="s2">            const float sobel_x_kernel[3][3] = { {-1, 0, 1}, {-2, 0, 2}, {-1, 0, 1} };</span>
<span class="s2">            const float sobel_y_kernel[3][3] = { {-1, -2, -1}, {0, 0, 0}, {1, 2, 1} };</span>

<span class="s2">            for (int i = -1; i &lt;= 1; ++i) {</span>
<span class="s2">                for (int j = -1; j &lt;= 1; ++j) {</span>
<span class="s2">                    sum_x += input[(y + i) * width + (x + j)] * sobel_x_kernel[i + 1][j + 1];</span>
<span class="s2">                    sum_y += input[(y + i) * width + (x + j)] * sobel_y_kernel[i + 1][j + 1];</span>
<span class="s2">                }</span>
<span class="s2">            }</span>

<span class="s2">            float gradient_magnitude = sqrt(sum_x * sum_x + sum_y * sum_y);</span>
<span class="s2">            gradient_magnitude = gradient_magnitude &gt; 255 ? 255 : gradient_magnitude;</span>

<span class="s2">            output[y * width + x] = (uchar)gradient_magnitude;</span>
<span class="s2">        } else {</span>
<span class="s2">            output[y * width + x] = 0;</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">"""</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">program</span><span class="o">.</span><span class="n">sobel_filter</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">input_buffer</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">input_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="c1"># read result</span>
<span class="n">output_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">input_array</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">enqueue_copy</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">output_array</span><span class="p">,</span> <span class="n">output_buffer</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

<span class="c1"># save image</span>
<span class="n">output_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">output_array</span><span class="p">,</span> <span class="s1">'L'</span><span class="p">)</span>
<span class="n">output_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'_images/edges.png'</span><span class="p">)</span>

<span class="c1"># show image</span>
<span class="c1"># output_image.show()</span>
</pre></div>
</div></div></div><a name='python-ci'></a><h2>ci<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#genetic-algorithm-optimization-py'>genetic-algorithm-optimization.py</a><a class='dotted' href='#particle-swarm-optimisation-py'>particle-swarm-optimisation.py</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#genetic-algorithm-optimization-py'>genetic-algorithm-optimization.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ci/genetic-algorithm-optimization.py' name='genetic-algorithm-optimization-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Genetic_algorithm</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="c1"># https://pypi.org/project/tabulate/</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># helper function to print as table</span>
<span class="k">def</span> <span class="nf">print_as_table</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span>
        <span class="n">population</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">'n'</span><span class="p">,</span> <span class="s1">'encoding'</span><span class="p">,</span> <span class="s1">'decoded x, y'</span><span class="p">,</span> <span class="s1">'cost'</span><span class="p">],</span>
        <span class="n">floatfmt</span><span class="o">=</span><span class="s2">".3f"</span><span class="p">,</span>
        <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"simple"</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_low</span><span class="p">,</span> <span class="n">x_high</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sd">"""Encode decimal number into binary</span>

<span class="sd">    x (int)                 : decimal number</span>
<span class="sd">    x_low (int)             : lower bound of x</span>
<span class="sd">    x_high (int)            : upper bound of x</span>
<span class="sd">    m (int)                 : number of bits</span>
<span class="sd">    """</span>
    <span class="n">decimal</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_low</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">x_high</span> <span class="o">-</span> <span class="n">x_low</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">decimal</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">decimal</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">binary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">decimal</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">decimal</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">binary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">binary</span><span class="p">))</span>

<span class="k">assert</span> <span class="n">encode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">x_low</span><span class="p">,</span> <span class="n">x_high</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="sd">"""Decode binary into decimal number</span>

<span class="sd">    B (list)                : binary number</span>
<span class="sd">    x_low (int)             : lower bound of x</span>
<span class="sd">    x_high (int)            : upper bound of x</span>
<span class="sd">    m (int)                 : number of bits</span>
<span class="sd">    """</span>

    <span class="k">return</span> <span class="n">x_low</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">B</span><span class="p">))),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x_high</span> <span class="o">-</span> <span class="n">x_low</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="mi">2</span> <span class="o">**</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">decode</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="mi">9</span>

<span class="k">def</span> <span class="nf">generate_population</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">n_pop</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">m_bits</span><span class="p">):</span>
    <span class="sd">"""Generate initial population</span>

<span class="sd">    f (function)            : cost function</span>
<span class="sd">    n_pop (int)             : number of population</span>
<span class="sd">    x_range (list)          : range of x</span>
<span class="sd">    y_range (list)          : range of y</span>
<span class="sd">    m_bits (int)            : number of bits</span>
<span class="sd">    """</span>
    <span class="n">pop_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_pop</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># encoded values</span>
        <span class="n">x_encoded</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">)</span>
        <span class="n">y_encoded</span> <span class="o">=</span> <span class="n">encode</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">)</span>
        <span class="c1"># decoded values</span>
        <span class="n">x_decoded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">x_encoded</span><span class="p">,</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">y_decoded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">y_encoded</span><span class="p">,</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># determine initial cost</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_decoded</span><span class="p">,</span> <span class="n">y_decoded</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># append to list</span>
        <span class="n">pop_lst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">x_encoded</span> <span class="o">+</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="p">[</span><span class="n">x_decoded</span><span class="p">,</span> <span class="n">y_decoded</span><span class="p">],</span> <span class="n">cost</span><span class="p">])</span>
    <span class="c1"># sort on cost</span>
    <span class="n">pop_lst</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="c1"># update index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop_lst</span><span class="p">)):</span>
        <span class="n">pop_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">pop_lst</span>

<span class="c1"># example_population = generate_population(</span>
<span class="c1">#     f,</span>
<span class="c1">#     n_pop=6,</span>
<span class="c1">#     x_range=[5, 20],</span>
<span class="c1">#     y_range=[-5, 15],</span>
<span class="c1">#     m_bits=4</span>
<span class="c1"># )</span>
<span class="c1"># print_as_table(example_population)</span>
<span class="c1">#   n  encoding                  decoded x, y       cost</span>
<span class="c1"># ---  ------------------------  --------------  -------</span>
<span class="c1">#   0  [0, 0, 1, 0, 1, 1, 1, 0]  [7.0, 13.67]     22.160</span>
<span class="c1">#   1  [0, 0, 1, 1, 1, 1, 0, 1]  [8.0, 12.33]     30.680</span>
<span class="c1">#   2  [0, 0, 1, 1, 0, 0, 0, 0]  [8.0, -5.0]     100.000</span>
<span class="c1">#   3  [1, 0, 0, 0, 0, 1, 0, 1]  [13.0, 1.67]    119.140</span>
<span class="c1">#   4  [0, 1, 1, 1, 0, 0, 1, 1]  [12.0, -1.0]    126.000</span>
<span class="c1">#   5  [1, 1, 0, 1, 0, 0, 0, 1]  [18.0, -3.67]   213.030</span>

<span class="k">def</span> <span class="nf">generate_offsprings</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">crossover</span><span class="p">):</span>
    <span class="sd">"""Generate offsprings</span>

<span class="sd">    population (list)       : population</span>
<span class="sd">    crossover (list)        : crossover points</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">offsprings_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
        <span class="n">offsprings_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">crossover</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">crossover</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">crossover</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">crossover</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="p">)</span>
        <span class="n">offsprings_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">crossover</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">crossover</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">crossover</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span>
            <span class="n">population</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">crossover</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span>
        <span class="p">)</span>
        <span class="c1"># pair-wise</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="n">offsprings_lst</span>

<span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">offsprings</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">m_bits</span><span class="p">):</span>
    <span class="sd">"""Mutate offsprings</span>

<span class="sd">    offsprings (list)       : offsprings</span>
<span class="sd">    mu (float)              : mutation rate</span>
<span class="sd">    m_bits (int)            : number of bits</span>
<span class="sd">    """</span>
    <span class="n">nbits</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offsprings</span><span class="p">)</span> <span class="o">*</span> <span class="n">m_bits</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbits</span><span class="p">):</span>
        <span class="n">offspring</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsprings</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">bit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_bits</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># flip bits</span>
        <span class="k">if</span> <span class="n">offsprings</span><span class="p">[</span><span class="n">offspring</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">offsprings</span><span class="p">[</span><span class="n">offspring</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offsprings</span><span class="p">[</span><span class="n">offspring</span><span class="p">][</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">offsprings</span>

<span class="k">def</span> <span class="nf">update_population</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">current_population</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">,</span> <span class="n">keep</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">m_bits</span><span class="p">):</span>
    <span class="sd">"""Update population</span>

<span class="sd">    f (function)                : cost function</span>
<span class="sd">    current_population (list)   : current population</span>
<span class="sd">    offsprings (list)           : offsprings</span>
<span class="sd">    keep (int)                  : number of population to keep</span>
<span class="sd">    x_range (list)              : range of x</span>
<span class="sd">    y_range (list)              : range of y</span>
<span class="sd">    m_bits (int)                : number of bits</span>
<span class="sd">    """</span>
    <span class="n">offsprings_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offsprings</span><span class="p">)):</span>
        <span class="c1"># decoded values</span>
        <span class="n">x_decoded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">offsprings</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">4</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">y_decoded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">decode</span><span class="p">(</span><span class="n">offsprings</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">:],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_bits</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># determine initial cost</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_decoded</span><span class="p">,</span> <span class="n">y_decoded</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># append to list</span>
        <span class="n">offsprings_lst</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">offsprings</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="n">x_decoded</span><span class="p">,</span> <span class="n">y_decoded</span><span class="p">],</span> <span class="n">cost</span><span class="p">])</span>
    <span class="c1"># sort on cost</span>
    <span class="n">offsprings_lst</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="c1"># update index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">offsprings_lst</span><span class="p">)):</span>
        <span class="n">offsprings_lst</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="c1"># discard current population</span>
    <span class="n">current_population</span><span class="p">[</span><span class="n">keep</span><span class="p">:]</span> <span class="o">=</span> <span class="n">offsprings_lst</span><span class="p">[:</span><span class="n">keep</span><span class="p">]</span>
    <span class="c1"># sort on cost</span>
    <span class="n">current_population</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="c1"># update index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_population</span><span class="p">)):</span>
        <span class="n">current_population</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">current_population</span>

<span class="n">M_BITS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">N_POP</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">N_KEEP</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">MUTATE_RATE</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1"># max number of generations</span>
<span class="n">MAX_GEN</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="c1"># crossover points</span>
<span class="n">crossover</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="c1"># cost function to minimize</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># bounds</span>
<span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="n">y_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>

<span class="n">current_population</span> <span class="o">=</span> <span class="n">generate_population</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">N_POP</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">M_BITS</span><span class="p">)</span>
<span class="n">print_as_table</span><span class="p">(</span><span class="n">current_population</span><span class="p">)</span>
<span class="c1">#   n  encoding                  decoded x, y       cost</span>
<span class="c1"># ---  ------------------------  --------------  -------</span>
<span class="c1">#   0  [0, 0, 0, 0, 1, 1, 1, 0]  [10.0, 6.2]      69.000</span>
<span class="c1">#   1  [0, 1, 0, 0, 0, 0, 1, 0]  [12.67, -3.4]   148.240</span>
<span class="c1">#   2  [0, 1, 1, 0, 0, 1, 0, 0]  [14.0, -1.8]    152.600</span>
<span class="c1">#   3  [1, 1, 1, 1, 0, 0, 0, 1]  [20.0, -4.2]    242.000</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_GEN</span><span class="p">):</span>
    <span class="c1"># generate offsprings</span>
    <span class="n">offsprings</span> <span class="o">=</span> <span class="n">generate_offsprings</span><span class="p">(</span><span class="n">current_population</span><span class="p">,</span> <span class="n">crossover</span><span class="p">)</span>
    <span class="c1"># mutate</span>
    <span class="n">offsprings</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">offsprings</span><span class="p">,</span> <span class="n">MUTATE_RATE</span><span class="p">,</span> <span class="n">M_BITS</span><span class="p">)</span>
    <span class="c1"># update population</span>
    <span class="n">current_population</span> <span class="o">=</span> <span class="n">update_population</span><span class="p">(</span>
        <span class="n">f</span><span class="p">,</span>
        <span class="n">current_population</span><span class="p">,</span>
        <span class="n">offsprings</span><span class="p">,</span>
        <span class="n">N_KEEP</span><span class="p">,</span>
        <span class="n">x_range</span><span class="p">,</span>
        <span class="n">y_range</span><span class="p">,</span>
        <span class="n">M_BITS</span>
    <span class="p">)</span>

<span class="n">print_as_table</span><span class="p">(</span><span class="n">current_population</span><span class="p">)</span>
<span class="c1">#   n  encoding                  decoded x, y      cost</span>
<span class="c1"># ---  ------------------------  --------------  ------</span>
<span class="c1">#   0  [0, 0, 0, 0, 1, 1, 1, 1]  [10.0, 7.0]     65.000</span>
<span class="c1">#   1  [0, 0, 0, 0, 1, 1, 1, 1]  [10.0, 7.0]     65.000</span>
<span class="c1">#   2  [0, 0, 0, 0, 1, 1, 1, 1]  [10.0, 7.0]     65.000</span>
<span class="c1">#   3  [0, 0, 0, 0, 1, 1, 1, 1]  [10.0, 7.0]     65.000</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#particle-swarm-optimisation-py'>particle-swarm-optimisation.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ci/particle-swarm-optimisation.py' name='particle-swarm-optimisation-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Particle_swarm_optimization</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># feel free to change this to stop at convergence</span>
<span class="n">MAX_ITERATIONS</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># constant inertia weight</span>
<span class="n">weight</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="c1"># cognative constant</span>
<span class="n">c_1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># social constant</span>
<span class="n">c_2</span> <span class="o">=</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">generate_swarm</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">n_par</span><span class="p">):</span>
    <span class="sd">"""Generate swarm of particles</span>

<span class="sd">    x_0 (list)              : initial position</span>
<span class="sd">    n_par (int)             : number of particles</span>
<span class="sd">    """</span>
    <span class="n">dimensions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_0</span><span class="p">)</span>
    <span class="n">swarm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># generate particles</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_par</span><span class="p">):</span>
        <span class="n">position</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># best position</span>
        <span class="n">position_best</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># particle velocity</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># particle error (cost)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># best error (cost)</span>
        <span class="n">error_best</span> <span class="o">=</span> <span class="n">error</span>
        <span class="c1"># position and velocity</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">):</span>
            <span class="n">position</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">velocity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># append particle</span>
        <span class="n">swarm</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">"dimensions"</span><span class="p">:</span> <span class="n">dimensions</span><span class="p">,</span>
            <span class="s2">"position"</span><span class="p">:</span> <span class="n">position</span><span class="p">,</span>
            <span class="s2">"position_best"</span><span class="p">:</span> <span class="n">position_best</span><span class="p">,</span>
            <span class="s2">"velocity"</span><span class="p">:</span> <span class="n">velocity</span><span class="p">,</span>
            <span class="s2">"error"</span><span class="p">:</span> <span class="n">error</span><span class="p">,</span>
            <span class="s2">"error_best"</span><span class="p">:</span> <span class="n">error_best</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">swarm</span>

<span class="k">def</span> <span class="nf">update_velocity</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">position_best</span><span class="p">,</span> <span class="n">global_pos</span><span class="p">):</span>
    <span class="sd">"""Update particle velocity</span>

<span class="sd">    velocity (float)        : particle velocity</span>
<span class="sd">    position (float)        : particle position</span>
<span class="sd">    position_best (float)   : best position</span>
<span class="sd">    global_pos (float)      : global best position</span>
<span class="sd">    """</span>
    <span class="c1"># random bias</span>
    <span class="n">r_1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">r_2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="c1"># update velocity</span>
    <span class="n">velocity_cognative</span> <span class="o">=</span> <span class="n">c_1</span> <span class="o">*</span> <span class="n">r_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">position_best</span> <span class="o">-</span> <span class="n">position</span><span class="p">)</span>
    <span class="n">velocity_social</span> <span class="o">=</span> <span class="n">c_2</span> <span class="o">*</span> <span class="n">r_2</span> <span class="o">*</span> <span class="p">(</span><span class="n">global_pos</span> <span class="o">-</span> <span class="n">position</span><span class="p">)</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">velocity</span> <span class="o">+</span> <span class="n">velocity_cognative</span> <span class="o">+</span> <span class="n">velocity_social</span>

    <span class="k">return</span> <span class="n">velocity</span>

<span class="k">def</span> <span class="nf">update_position</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">velocity</span><span class="p">):</span>
    <span class="sd">"""Update particle position</span>

<span class="sd">    position (float)        : particle position</span>
<span class="sd">    velocity (float)        : particle velocity</span>
<span class="sd">    """</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">velocity</span>
    <span class="k">return</span> <span class="n">position</span>

<span class="k">def</span> <span class="nf">iterate_swarm</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">swarm</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">global_best</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">global_pos</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">"""Iterate swarm</span>

<span class="sd">    f (function)            : cost function</span>
<span class="sd">    swarm (list)            : list of particles</span>
<span class="sd">    bounds (list)           : list of bounds for each dimension</span>
<span class="sd">    global_best (float)     : global best error</span>
<span class="sd">    global_pos (float)      : global best position</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">swarm</span><span class="p">)):</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"dimensions"</span><span class="p">]</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"position"</span><span class="p">]</span>
        <span class="n">error_best</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"error_best"</span><span class="p">]</span>
        <span class="c1"># evaluate new error (cost)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="c1"># update local best position if current position gives</span>
        <span class="c1"># better local error</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;</span> <span class="n">error_best</span> <span class="ow">or</span> <span class="n">error_best</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"position_best"</span><span class="p">]</span> <span class="o">=</span> <span class="n">position</span>
            <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"error_best"</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span>
        <span class="n">position_best</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"position_best"</span><span class="p">]</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">swarm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s2">"velocity"</span><span class="p">]</span>
        <span class="c1"># update global best if position of current particle gives</span>
        <span class="c1"># best global error</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">&lt;</span> <span class="n">global_best</span> <span class="ow">or</span> <span class="n">global_best</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">global_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="n">global_best</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="c1"># update particle velocity and position</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">):</span>
            <span class="n">velocity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_velocity</span><span class="p">(</span>
                <span class="n">velocity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">position_best</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">global_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">update_position</span><span class="p">(</span>
                <span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">velocity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="c1"># max value for position</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="ow">and</span> <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># min value for position</span>
            <span class="k">if</span> <span class="n">bounds</span> <span class="ow">and</span> <span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">position</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># return</span>
    <span class="k">return</span> <span class="n">swarm</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">global_best</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">global_pos</span><span class="p">]</span>

<span class="c1"># minimize x^5 - 3x^4 + 5 over [0, 4]</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">5</span>
<span class="c1"># reset global</span>
<span class="n">global_best</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">global_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1"># initial swarm</span>
<span class="n">swarm</span> <span class="o">=</span> <span class="n">generate_swarm</span><span class="p">(</span><span class="n">x_0</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">n_par</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># iterate swarm</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_ITERATIONS</span><span class="p">):</span>
    <span class="n">swarm</span><span class="p">,</span> <span class="n">global_best</span><span class="p">,</span> <span class="n">global_pos</span> <span class="o">=</span> <span class="n">iterate_swarm</span><span class="p">(</span>
        <span class="n">f</span><span class="p">,</span>
        <span class="n">swarm</span><span class="p">,</span>
        <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="n">global_best</span><span class="o">=</span><span class="n">global_best</span><span class="p">,</span>
        <span class="n">global_pos</span><span class="o">=</span><span class="n">global_pos</span>
    <span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">global_best</span><span class="p">,</span> <span class="n">global_pos</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mf">14.91</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.39</span><span class="p">])</span>

<span class="c1"># minimize -(5 + 3x - 4y - x^2 + x y - y^2)</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># reset global</span>
<span class="n">global_best</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">global_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1"># initial swarm</span>
<span class="n">swarm</span> <span class="o">=</span> <span class="n">generate_swarm</span><span class="p">(</span><span class="n">x_0</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">n_par</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># iterate swarm</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_ITERATIONS</span><span class="p">):</span>
    <span class="n">swarm</span><span class="p">,</span> <span class="n">global_best</span><span class="p">,</span> <span class="n">global_pos</span> <span class="o">=</span> <span class="n">iterate_swarm</span><span class="p">(</span>
        <span class="n">f</span><span class="p">,</span>
        <span class="n">swarm</span><span class="p">,</span>
        <span class="n">global_best</span><span class="o">=</span><span class="n">global_best</span><span class="p">,</span>
        <span class="n">global_pos</span><span class="o">=</span><span class="n">global_pos</span>
    <span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">global_best</span><span class="p">,</span> <span class="n">global_pos</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mf">9.33</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.67</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.67</span><span class="p">])</span>
</pre></div>
</div></div></div><a name='python-ml'></a><h2>ml<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#backpropagation-py'>backpropagation.py</a><a class='dotted' href='#convolutional-neural-network-py'>convolutional-neural-network.py</a><a class='dotted' href='#delta-learning-algorithm-py'>delta-learning-algorithm.py</a><a class='dotted' href='#gradient-descent-algorithm-py'>gradient-descent-algorithm.py</a><a class='dotted' href='#k-nearest-neighbors-classifier-py'>k-nearest-neighbors-classifier.py</a><a class='dotted' href='#linear-threshold-unit-py'>linear-threshold-unit.py</a><a class='dotted' href='#numpy-linear-relu-py'>numpy-linear-relu.py</a><a class='dotted' href='#widrow-hoff-learning-algorithm-py'>widrow-hoff-learning-algorithm.py</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#backpropagation-py'>backpropagation.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/backpropagation.py' name='backpropagation-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Backpropagation</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># https://en.wikipedia.org/wiki/Sigmoid_function</span>
<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">sigmoid</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># derivative of sigmoid</span>
<span class="k">def</span> <span class="nf">sigmoid_dx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">sigmoid_dx</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="c1"># input</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="c1"># weights</span>
<span class="n">w_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span>
<span class="n">w_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># output</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">feedforward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="n">layer_1</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_1</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">layer_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">output</span>

<span class="k">def</span> <span class="nf">backpropagation</span><span class="p">(</span><span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="n">w_2_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">layer_1</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigmoid_dx</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">w_1_dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigmoid_dx</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">w_2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sigmoid_dx</span><span class="p">(</span><span class="n">layer_1</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="c1"># update weights</span>
    <span class="n">w_1</span> <span class="o">+=</span> <span class="n">w_1_dx</span>
    <span class="n">w_2</span> <span class="o">+=</span> <span class="n">w_2_dx</span>

    <span class="k">return</span> <span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">output</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1500</span><span class="p">):</span>
    <span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">feedforward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="n">backpropagation</span><span class="p">(</span><span class="n">layer_1</span><span class="p">,</span> <span class="n">w_1</span><span class="p">,</span> <span class="n">w_2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="c1"># [[0.01043733]</span>
<span class="c1">#  [0.97230567]</span>
<span class="c1">#  [0.97090151]</span>
<span class="c1">#  [0.03501066]]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#convolutional-neural-network-py'>convolutional-neural-network.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/convolutional-neural-network.py' name='convolutional-neural-network-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Convolutional_neural_network</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">tensorflow.keras.datasets</span> <span class="kn">import</span> <span class="n">mnist</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span><span class="p">,</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">to_categorical</span>
<span class="kn">from</span> <span class="nn">tqdm.keras</span> <span class="kn">import</span> <span class="n">TqdmCallback</span>

<span class="c1"># avoid libiomp5 error and less noise</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"KMP_DUPLICATE_LIB_OK"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"True"</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">"CUDA_VISIBLE_DEVICES"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">""</span>

<span class="c1"># configuration</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># https://keras.io/datasets</span>
<span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="c1"># reshape and set type</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'float32'</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'float32'</span><span class="p">)</span>

<span class="c1"># normalize</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span> <span class="o">/</span> <span class="mi">255</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span> <span class="o">/</span> <span class="mi">255</span>

<span class="c1"># https://en.wikipedia.org/wiki/One-hot</span>
<span class="n">Y_train</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">Y_train</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
<span class="n">Y_test</span> <span class="o">=</span> <span class="n">to_categorical</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">)</span>
<span class="c1"># print(Y_train.shape)</span>
<span class="c1"># print(Y_test.shape)</span>

<span class="c1"># https://keras.io/models/sequential</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>
<span class="c1"># layers</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="n">pool_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Flatten</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'softmax'</span><span class="p">))</span>

<span class="c1"># https://keras.io/optimizers</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">'categorical_crossentropy'</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">'accuracy'</span><span class="p">],</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">'adadelta'</span><span class="p">)</span>

<span class="c1"># train model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">Y_train</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">),</span>
    <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">TqdmCallback</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="p">)</span>

<span class="c1"># evaluate</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># metrics</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span> <span class="c1"># 0.029002553918152263</span>
<span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span> <span class="c1"># 0.9906</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#delta-learning-algorithm-py'>delta-learning-algorithm.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/delta-learning-algorithm.py' name='delta-learning-algorithm-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Delta_rule</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># initial weights</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># learning rate</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># iterations</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># dataset</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]]</span>
<span class="c1"># classes</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># https://en.wikipedia.org/wiki/Heaviside_step_function</span>
<span class="k">def</span> <span class="nf">transfer_function</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">wx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">wx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">wx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">transfer_function</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">transfer_function</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">transfer_function</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># sequential delta learning algorithm</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">iterations</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">o</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">iterations</span><span class="p">):</span> <span class="k">break</span>
        <span class="n">w_prev</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">transfer_function</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="c1"># calculate update part</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> <span class="n">update</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># add update part to w</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="c1"># append to result</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
            <span class="c1"># iteration</span>
            <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">o</span><span class="p">),</span>
            <span class="c1"># w</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">w_prev</span><span class="p">),</span>
            <span class="c1"># x</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="c1"># y = H(wx)</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="c1"># t</span>
            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="c1"># w_new</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">w</span><span class="p">)]</span>
        <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y = H(wx)'</span><span class="p">,</span> <span class="s1">'t'</span><span class="p">,</span> <span class="s1">'w_new'</span><span class="p">],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">))</span>
<span class="c1">#   i  w                 x              y = H(wx)    t  w_new</span>
<span class="c1"># ---  ----------------  -----------  -----------  ---  ----------------</span>
<span class="c1">#   1  [1, 0, 0]         [1, 0, 2]              1    1  [1.0, 0.0, 0.0]</span>
<span class="c1">#   2  [1.0, 0.0, 0.0]   [1, 1, 2]              1    1  [1.0, 0.0, 0.0]</span>
<span class="c1">#   3  [1.0, 0.0, 0.0]   [1, 2, 1]              1    1  [1.0, 0.0, 0.0]</span>
<span class="c1">#   4  [1.0, 0.0, 0.0]   [1, -3, 1]             1    0  [0.0, 3.0, -1.0]</span>
<span class="c1">#   5  [0.0, 3.0, -1.0]  [1, -2, -1]            0    0  [0.0, 3.0, -1.0]</span>
<span class="c1">#   6  [0.0, 3.0, -1.0]  [1, -3, -2]            0    0  [0.0, 3.0, -1.0]</span>
<span class="c1">#   7  [0.0, 3.0, -1.0]  [1, 0, 2]              0    1  [1.0, 3.0, 1.0]</span>
<span class="c1">#   8  [1.0, 3.0, 1.0]   [1, 1, 2]              1    1  [1.0, 3.0, 1.0]</span>
<span class="c1">#   9  [1.0, 3.0, 1.0]   [1, 2, 1]              1    1  [1.0, 3.0, 1.0]</span>
<span class="c1">#  10  [1.0, 3.0, 1.0]   [1, -3, 1]             0    0  [1.0, 3.0, 1.0]</span>
<span class="c1">#  11  [1.0, 3.0, 1.0]   [1, -2, -1]            0    0  [1.0, 3.0, 1.0]</span>
<span class="c1">#  12  [1.0, 3.0, 1.0]   [1, -3, -2]            0    0  [1.0, 3.0, 1.0]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#gradient-descent-algorithm-py'>gradient-descent-algorithm.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/gradient-descent-algorithm.py' name='gradient-descent-algorithm-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Gradient_descent</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gradient_descent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">):</span>
    <span class="sd">"""Gradient descent algorithm</span>

<span class="sd">    x (numpy.ndarray)       : input data</span>
<span class="sd">    y (numpy.ndarray)       : target variable</span>
<span class="sd">    theta (numpy.ndarray)   : parameters</span>
<span class="sd">    alpha (float)           : learning rate</span>
<span class="sd">    m (int)                 : number of examples</span>
<span class="sd">    num_iterations (int)    : number of iterations</span>
<span class="sd">    """</span>
    <span class="n">x_transpose</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">):</span>
        <span class="n">hypothesis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">hypothesis</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">loss</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>
        <span class="c1"># print</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Iteration: </span><span class="si">%d</span><span class="s2">, Cost: </span><span class="si">%f</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cost</span><span class="p">))</span>
        <span class="c1"># average gradient per example</span>
        <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_transpose</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span>
        <span class="c1"># update</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">gradient</span>

    <span class="k">return</span> <span class="n">theta</span>

<span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">num_points</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">variance</span><span class="p">):</span>
    <span class="sd">"""Generate data</span>

<span class="sd">    num_points (int)    : number of points</span>
<span class="sd">    bias (int)          : bias</span>
<span class="sd">    variance (int)      : variance</span>
<span class="sd">    """</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
    <span class="c1"># straight line</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_points</span><span class="p">):</span>
        <span class="c1"># bias feature</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># target variable</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">bias</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">variance</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="c1"># generate data</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># configuration variables</span>
<span class="n">num_iterations</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># run gradient descent</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">gradient_descent</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">num_iterations</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="c1"># Iteration: 0, Cost: 3417.449751</span>
<span class="c1"># Iteration: 1, Cost: 3411.478114</span>
<span class="c1"># Iteration: 2, Cost: 3405.518415</span>
<span class="c1"># ...</span>
<span class="c1"># Iteration: 9997, Cost: 430.137723</span>
<span class="c1"># Iteration: 9998, Cost: 430.137723</span>
<span class="c1"># Iteration: 9999, Cost: 430.137723</span>
<span class="c1"># [39.64610036 39.64610036]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#k-nearest-neighbors-classifier-py'>k-nearest-neighbors-classifier.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/k-nearest-neighbors-classifier.py' name='k-nearest-neighbors-classifier-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># load iris dataset</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_iris</span><span class="p">()</span>
<span class="c1"># sample to test classifier</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

<span class="c1"># sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">accuracy_score</span>

<span class="c1"># split training dataset</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># training and predictions</span>
<span class="n">classifier</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">'euclidean'</span><span class="p">)</span>
<span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">)</span>

<span class="c1"># evaluate</span>
<span class="n">Y_prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="c1"># print(confusion_matrix(Y_test, Y_prediction))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">Y_prediction</span><span class="p">))</span>
<span class="c1">#               precision    recall  f1-score   support</span>

<span class="c1">#            0       1.00      1.00      1.00        11</span>
<span class="c1">#            1       0.91      0.91      0.91        11</span>
<span class="c1">#            2       0.88      0.88      0.88         8</span>

<span class="c1">#     accuracy                           0.93        30</span>
<span class="c1">#    macro avg       0.93      0.93      0.93        30</span>
<span class="c1"># weighted avg       0.93      0.93      0.93        30</span>
<span class="nb">print</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">Y_test</span><span class="p">,</span> <span class="n">Y_prediction</span><span class="p">))</span>
<span class="c1"># 0.9333333333333333</span>

<span class="c1"># predict sample</span>
<span class="n">Y_prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">],</span> <span class="n">Y_prediction</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">'sample'</span><span class="p">,</span> <span class="s1">'label'</span><span class="p">],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">))</span>
<span class="c1"># sample                  label</span>
<span class="c1"># --------------------  -------</span>
<span class="c1"># [4.4, 4.2, 1.0, 1.0]        0</span>
<span class="c1"># [7.9, 2.0, 3.7, 1.2]        1</span>
<span class="c1"># [4.0, 3.0, 4.3, 0.8]        1</span>
<span class="c1"># [5.7, 3.2, 3.0, 0.5]        1</span>
<span class="c1"># [6.2, 2.8, 2.3, 0.2]        0</span>
<span class="c1"># [5.3, 2.5, 1.7, 2.2]        0</span>
<span class="c1"># [4.9, 2.2, 7.0, 0.0]        2</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#linear-threshold-unit-py'>linear-threshold-unit.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/linear-threshold-unit.py' name='linear-threshold-unit-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Artificial_neuron</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># https://en.wikipedia.org/wiki/Heaviside_step_function</span>
<span class="k">def</span> <span class="nf">H</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">wx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">wx</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>

<span class="k">assert</span> <span class="p">(</span><span class="n">H</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">H</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># logical AND</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'AND'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'AND'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'AND'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'AND'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>

<span class="c1"># logical NOT</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'NOT'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'NOT'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>

<span class="c1"># logical OR</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'OR'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'OR'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'OR'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'OR'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>

<span class="c1"># combination: (A AND NOT B) OR (A AND C) OR (NOT B AND C)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'COMBINATION'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'COMBINATION'</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>
<span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'COMBINATION'</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">H</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">threshold</span><span class="p">)])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">'unit'</span><span class="p">,</span> <span class="s1">'x'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="s1">'threshold'</span><span class="p">,</span> <span class="s1">'output'</span><span class="p">],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">))</span>
<span class="c1"># unit         x          w             threshold    output</span>
<span class="c1"># -----------  ---------  ----------  -----------  --------</span>
<span class="c1"># AND          [0, 0]     [1, 1]              1.5         0</span>
<span class="c1"># AND          [0, 1]     [1, 1]              1.5         0</span>
<span class="c1"># AND          [1, 0]     [1, 1]              1.5         0</span>
<span class="c1"># AND          [1, 1]     [1, 1]              1.5         1</span>
<span class="c1"># NOT          [0]        [-1]               -0.5         1</span>
<span class="c1"># NOT          [1]        [-1]               -0.5         0</span>
<span class="c1"># OR           [0, 0]     [1, 1]              0.5         0</span>
<span class="c1"># OR           [0, 1]     [1, 1]              0.5         1</span>
<span class="c1"># OR           [1, 0]     [1, 1]              0.5         1</span>
<span class="c1"># OR           [1, 1]     [1, 1]              0.5         1</span>
<span class="c1"># COMBINATION  [0, 0, 0]  [2, -2, 2]          1           0</span>
<span class="c1"># COMBINATION  [1, 0, 0]  [2, -2, 2]          1           1</span>
<span class="c1"># COMBINATION  [0, 1, 0]  [2, -2, 2]          1           0</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#numpy-linear-relu-py'>numpy-linear-relu.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/numpy-linear-relu.py' name='numpy-linear-relu-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">A simple implementation of linear layer followed by a</span>
<span class="sd">ReLU activation function.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">dtype</span> <span class="o">=</span> <span class="s2">"float32"</span>

<span class="c1"># numpy</span>
<span class="n">a_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">b_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
<span class="c1"># matmul -&gt; relu</span>
<span class="n">c_mm_relu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">a_np</span> <span class="o">@</span> <span class="n">b_np</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># implementation</span>
<span class="k">def</span> <span class="nf">mm_relu</span><span class="p">(</span><span class="n">A</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">B</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">C</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
    <span class="c1"># A, B, C: 128x128</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="c1"># matmul</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    <span class="c1"># relu</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># test</span>
<span class="n">c_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="n">mm_relu</span><span class="p">(</span><span class="n">a_np</span><span class="p">,</span> <span class="n">b_np</span><span class="p">,</span> <span class="n">c_np</span><span class="p">)</span>
<span class="c1"># check within tolerance</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">c_mm_relu</span><span class="p">,</span> <span class="n">c_np</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#widrow-hoff-learning-algorithm-py'>widrow-hoff-learning-algorithm.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/ml/widrow-hoff-learning-algorithm.py' name='widrow-hoff-learning-algorithm-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://www.cs.princeton.edu/courses/archive/spring13/cos511/scribe_notes/0411.pdf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># initial values</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1"># margin vector</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># learning rate</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="c1"># iterations</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># dataset</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

<span class="c1"># sequential widrow-hoff learning algorithm</span>
<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">iterations</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">))):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)):</span>
        <span class="n">w_prev</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># calculate wy</span>
        <span class="n">wy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c1"># calculate update part</span>
        <span class="n">update</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span> <span class="n">update</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">wy</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="c1"># add update part to a</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span>
        <span class="c1"># append result</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
            <span class="c1"># i</span>
            <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="n">o</span><span class="p">),</span>
            <span class="c1"># w</span>
            <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">w_prev</span><span class="p">],</span>
            <span class="c1"># y</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
            <span class="c1"># wy</span>
            <span class="nb">round</span><span class="p">(</span><span class="n">wy</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="c1"># w_new</span>
            <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">w</span><span class="p">]</span>
        <span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">,</span> <span class="s1">'wy'</span><span class="p">,</span> <span class="s1">'w_new'</span><span class="p">],</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"simple"</span><span class="p">))</span>
<span class="c1">#   i  w                       y                wy  w_new</span>
<span class="c1"># ---  ----------------------  -----------  ------  ----------------------</span>
<span class="c1">#   1  [1, 0, 0]               [1, 0, 2]     1      [1.0, 0.0, 0.0]</span>
<span class="c1">#   2  [1.0, 0.0, 0.0]         [1, 1, 2]     1      [1.0, 0.0, 0.0]</span>
<span class="c1">#   3  [1.0, 0.0, 0.0]         [1, 2, 1]     1      [1.0, 0.0, 0.0]</span>
<span class="c1">#   4  [1.0, 0.0, 0.0]         [-1, 3, -1]  -1      [0.8, 0.6, -0.2]</span>
<span class="c1">#   5  [0.8, 0.6, -0.2]        [-1, 2, 1]    0.2    [0.72, 0.76, -0.12]</span>
<span class="c1">#   6  [0.72, 0.76, -0.12]     [-1, 3, 2]    1.32   [0.752, 0.664, -0.184]</span>
<span class="c1">#   7  [0.752, 0.664, -0.184]  [1, 0, 2]     0.384  [0.814, 0.664, -0.061]</span>
<span class="c1">#   8  [0.814, 0.664, -0.061]  [1, 1, 2]     1.356  [0.778, 0.628, -0.132]</span>
<span class="c1">#   9  [0.778, 0.628, -0.132]  [1, 2, 1]     1.903  [0.688, 0.448, -0.222]</span>
<span class="c1">#  10  [0.688, 0.448, -0.222]  [-1, 3, -1]   0.878  [0.676, 0.484, -0.234]</span>
<span class="c1">#  11  [0.676, 0.484, -0.234]  [-1, 2, 1]    0.059  [0.581, 0.673, -0.14]</span>
<span class="c1">#  12  [0.581, 0.673, -0.14]   [-1, 3, 2]    1.156  [0.597, 0.626, -0.172]</span>
</pre></div>
</div></div></div><a name='python-euler'></a><h2>euler<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='##1-multiples-of-3-and-5-py'>#1-multiples-of-3-and-5.py</a><a class='dotted' href='##2-even-fibonacci-numbers-py'>#2-even-fibonacci-numbers.py</a><a class='dotted' href='##3-largest-prime-factor-py'>#3-largest-prime-factor.py</a><a class='dotted' href='##4-largest-palindrome-product-py'>#4-largest-palindrome-product.py</a><a class='dotted' href='##5-smallest-multiple-py'>#5-smallest-multiple.py</a><a class='dotted' href='##6-sum-square-difference-py'>#6-sum-square-difference.py</a><a class='dotted' href='##7-10001st-prime-py'>#7-10001st-prime.py</a><a class='dotted' href='##8-largest-product-in-a-series-py'>#8-largest-product-in-a-series.py</a><a class='dotted' href='##9-special-pythagorean-triplet-py'>#9-special-pythagorean-triplet.py</a><a class='dotted' href='##10-summation-of-primes-py'>#10-summation-of-primes.py</a><a class='dotted' href='##11-largest-product-in-grid-py'>#11-largest-product-in-grid.py</a><a class='dotted' href='##12-highly-divisible-triangular-number-py'>#12-highly-divisible-triangular-number.py</a><a class='dotted' href='##13-large-sum-py'>#13-large-sum.py</a><a class='dotted' href='##14-longest-collatz-sequence-py'>#14-longest-collatz-sequence.py</a><a class='dotted' href='##15-lattice-paths-py'>#15-lattice-paths.py</a><a class='dotted' href='##16-power-digit-sum-py'>#16-power-digit-sum.py</a><a class='dotted' href='##17-number-letter-counts-py'>#17-number-letter-counts.py</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='##1-multiples-of-3-and-5-py'>#1-multiples-of-3-and-5.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#1-multiples-of-3-and-5.py' name='#1-multiples-of-3-and-5-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Multiples of 3 and 5</span>

<span class="sd">If we list all the natural numbers below 10 that are multiples </span>
<span class="sd">of 3 or 5, we get 3, 5, 6 and 9. The sum of these multiples is </span>
<span class="sd">23.</span>

<span class="sd">Find the sum of all the multiples of 3 or 5 below 1000.</span>

<span class="sd">https://projecteuler.net/problem=1</span>
<span class="sd">"""</span>

<span class="c1"># solution</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="c1"># 233168</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##2-even-fibonacci-numbers-py'>#2-even-fibonacci-numbers.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#2-even-fibonacci-numbers.py' name='#2-even-fibonacci-numbers-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-10</span>

<span class="sd">"""</span>
<span class="sd">Even Fibonacci numbers</span>

<span class="sd">Each new term in the Fibonacci sequence is generated by </span>
<span class="sd">adding the previous two terms. By starting with 1 and 2, </span>
<span class="sd">the first 10 terms will be: 1, 2, 3, 5, 8, 13, 21, 34, </span>
<span class="sd">55, 89, ...</span>

<span class="sd">By considering the terms in the Fibonacci sequence whose </span>
<span class="sd">values do not exceed four million, find the sum of the </span>
<span class="sd">even-valued terms.</span>

<span class="sd">https://projecteuler.net/problem=2</span>
<span class="sd">"""</span>

<span class="c1"># test</span>
<span class="c1"># seq = list()</span>
<span class="c1"># for n in list(range(10)):</span>
<span class="c1">#     if n == 0:</span>
<span class="c1">#         seq.append(1)</span>
<span class="c1">#     if n == 1:</span>
<span class="c1">#         seq.append(2)</span>
<span class="c1">#     if n &gt; 1:</span>
<span class="c1">#         seq.append(seq[n - 2] + seq[n - 1])</span>

<span class="c1"># assert(seq == list([1, 2, 3, 5, 8, 13, 21, 34, 55, 89]))</span>

<span class="c1"># solution</span>
<span class="n">seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">max_value</span> <span class="o">=</span> <span class="mi">4000000</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">seq</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># break condition</span>
    <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_value</span><span class="p">:</span>
        <span class="n">seq</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">break</span>

    <span class="c1"># even</span>
    <span class="k">if</span> <span class="n">seq</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="c1"># 4613732</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##3-largest-prime-factor-py'>#3-largest-prime-factor.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#3-largest-prime-factor.py' name='#3-largest-prime-factor-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-10</span>

<span class="sd">"""</span>
<span class="sd">Largest prime factor</span>

<span class="sd">The prime factors of 13195 are 5, 7, 13 and 29.</span>

<span class="sd">What is the largest prime factor of the number 600851475143?</span>

<span class="sd">https://projecteuler.net/problem=3</span>
<span class="sd">"""</span>

<span class="c1"># test</span>
<span class="c1"># number = 13195 </span>
<span class="c1"># result = list()</span>

<span class="c1"># factor = number - 1</span>
<span class="c1"># while factor &gt; 1:</span>
<span class="c1">#     if number % factor == 0:</span>
<span class="c1">#         # factor</span>
<span class="c1">#         subfactor = factor - 1</span>
<span class="c1">#         while subfactor &gt; 1:</span>
<span class="c1">#             if factor % subfactor == 0:</span>
<span class="c1">#                 break</span>

<span class="c1">#             subfactor -= 1</span>

<span class="c1">#         if subfactor == 1:</span>
<span class="c1">#             result.append(factor)</span>

<span class="c1">#     factor -= 1</span>

<span class="c1"># assert(max(result) == 29)</span>

<span class="c1"># solution (too slow)</span>
<span class="c1"># number = 600851475143</span>
<span class="c1"># result = list()</span>

<span class="c1"># factor = number - 1</span>
<span class="c1"># while factor &gt; 1:</span>
<span class="c1">#   if number % factor == 0:</span>
<span class="c1">#       # factor</span>
<span class="c1">#       subfactor = factor - 1</span>
<span class="c1">#       while subfactor &gt; 1:</span>
<span class="c1">#           if factor % subfactor == 0:</span>
<span class="c1">#               break</span>

<span class="c1">#           subfactor -= 1</span>

<span class="c1">#       if subfactor == 1:</span>
<span class="c1">#           print(factor)</span>
<span class="c1">#           result.append(factor)</span>

<span class="c1">#   factor -= 1</span>

<span class="c1"># print(max(result))</span>

<span class="c1"># solution (faster)</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="n">number</span> <span class="o">=</span> <span class="mi">600851475143</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">while</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">number</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">number</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span> <span class="o">/</span> <span class="n">i</span>

<span class="k">if</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="c1"># 6857</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##4-largest-palindrome-product-py'>#4-largest-palindrome-product.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#4-largest-palindrome-product.py' name='#4-largest-palindrome-product-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-10</span>

<span class="sd">"""</span>
<span class="sd">Largest palindrome product</span>

<span class="sd">A palindromic number reads the same both ways. The </span>
<span class="sd">largest palindrome made from the product of two 2-digit </span>
<span class="sd">numbers is 9009 = 91  99.</span>

<span class="sd">Find the largest palindrome made from the product of two 3-digit numbers.</span>

<span class="sd">https://projecteuler.net/problem=4</span>
<span class="sd">"""</span>

<span class="c1"># test</span>
<span class="c1"># MAX_2 = 100</span>

<span class="c1"># nlst = list(range(MAX_2))[80:]</span>
<span class="c1"># result = list()</span>
<span class="c1"># for i in nlst:</span>
<span class="c1">#     for j in nlst:</span>
<span class="c1">#         product = i * j</span>
<span class="c1">#         if list(str(product)) == list(str(product))[::-1]:</span>
<span class="c1">#             result.append(product)</span>

<span class="c1"># assert(max(result) == 9009)</span>

<span class="c1"># solution</span>
<span class="n">MAX_2</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">nlst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">MAX_2</span><span class="p">))[</span><span class="mi">800</span><span class="p">:]</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nlst</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">nlst</span><span class="p">:</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">product</span><span class="p">))</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">product</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="c1"># 906609</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##5-smallest-multiple-py'>#5-smallest-multiple.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#5-smallest-multiple.py' name='#5-smallest-multiple-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-10</span>

<span class="sd">"""</span>
<span class="sd">Smallest multiple</span>

<span class="sd">2520 is the smallest number that can be divided by </span>
<span class="sd">each of the numbers from 1 to 10 without any remainder.</span>

<span class="sd">What is the smallest positive number that is evenly </span>
<span class="sd">divisible by all of the numbers from 1 to 20?</span>

<span class="sd">https://projecteuler.net/problem=5</span>
<span class="sd">"""</span>

<span class="c1"># test</span>
<span class="c1"># MAX_ITER = 10000</span>

<span class="c1"># number = 1</span>
<span class="c1"># nlst = list(range(1, 11))</span>
<span class="c1"># result = -1</span>
<span class="c1"># while number &lt; MAX_ITER:</span>
<span class="c1">#     divisible = True</span>

<span class="c1">#     for n in nlst:</span>
<span class="c1">#         if number % n != 0:</span>
<span class="c1">#             divisible = False</span>
<span class="c1">#             break</span>

<span class="c1">#     if divisible:</span>
<span class="c1">#         result = number</span>
<span class="c1">#         break</span>

<span class="c1">#     number += 1</span>

<span class="c1"># assert(result == 2520)</span>

<span class="c1"># solution</span>
<span class="n">MAX_ITER</span> <span class="o">=</span> <span class="mi">1000000000</span>

<span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nlst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
<span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">while</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="n">MAX_ITER</span><span class="p">:</span>
    <span class="n">divisible</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nlst</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">divisible</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">divisible</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">number</span>
        <span class="k">break</span>

    <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># 232792560</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##6-sum-square-difference-py'>#6-sum-square-difference.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#6-sum-square-difference.py' name='#6-sum-square-difference-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-11</span>

<span class="sd">"""</span>
<span class="sd">Sum square difference</span>

<span class="sd">The sum of the squares of the first ten natural numbers </span>
<span class="sd">is, 1^2 + 2^2 + ... + 10^2 = 385.</span>

<span class="sd">The square of the sum of the first ten natural numbers </span>
<span class="sd">is, (1 + 2 + ... + 10^2) = 55^2 = 3025.</span>

<span class="sd">Hence the difference between the sum of the squares of </span>
<span class="sd">the first ten natural numbers and the square of the sum </span>
<span class="sd">is 3025 - 385 = 2640.</span>

<span class="sd">Find the difference between the sum of the squares of the </span>
<span class="sd">first one hundred natural numbers and the square of the sum.</span>

<span class="sd">https://projecteuler.net/problem=6</span>
<span class="sd">"""</span>

<span class="c1"># test</span>
<span class="c1"># nlist = list(range(1, 11))</span>

<span class="c1"># sum_square = 0</span>
<span class="c1"># for n in nlist:</span>
<span class="c1">#     sum_square += (n ** 2)</span>

<span class="c1"># square_sum = sum(nlist) ** 2</span>

<span class="c1"># assert(square_sum - sum_square == 2640)</span>

<span class="c1"># solution</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">))</span>

<span class="n">sum_square</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nlist</span><span class="p">:</span>
    <span class="n">sum_square</span> <span class="o">+=</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">square_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nlist</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">square_sum</span> <span class="o">-</span> <span class="n">sum_square</span><span class="p">)</span>
<span class="c1"># 25164150</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##7-10001st-prime-py'>#7-10001st-prime.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#7-10001st-prime.py' name='#7-10001st-prime-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-10</span>

<span class="sd">"""</span>
<span class="sd">10001st prime</span>

<span class="sd">By listing the first six prime numbers: 2, 3, 5, 7,</span>
<span class="sd">11, and 13, we can see that the 6th prime is 13.</span>

<span class="sd">What is the 10001st prime number?</span>

<span class="sd"># https://projecteuler.net/problem=7</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># test (too slow)</span>

<span class="c1"># algorithm:</span>
<span class="c1"># (n) = (sum from j=2 to n) [ ((j-1)! + 1)/j - [(j-1)!/j] ]</span>
<span class="c1"># nth prime = 1 + (sum from m=1 to j=2 ** n) [ [ n/(1 + (m)) ]1/n ]</span>
<span class="c1"># [x] is floor function</span>

<span class="c1"># def pi(n):</span>
<span class="c1">#   pi_n = 0</span>
<span class="c1">#   for j in range(n + 1):</span>
<span class="c1">#       if j &lt; 2:</span>
<span class="c1">#           pass</span>
<span class="c1">#       else:</span>
<span class="c1">#           pi_n += math.floor(((math.factorial(j - 1) + 1) // j) - math.floor(math.factorial(j - 1) // j))</span>

<span class="c1">#   return pi_n</span>

<span class="c1"># def n_prime(n):</span>
<span class="c1">#   n_prime = 0</span>
<span class="c1">#   for m in range(2 ** n + 1):</span>
<span class="c1">#       if m &lt; 1:</span>
<span class="c1">#           pass</span>
<span class="c1">#       else:</span>
<span class="c1">#           n_prime += math.floor(math.floor(n // (1 + pi(m))) ** (1 / n))</span>
<span class="c1">#   n_prime += 1</span>
<span class="c1">#   return n_prime</span>

<span class="c1"># assert(n_prime(6) == 13)</span>

<span class="c1"># solution</span>

<span class="n">MAX_SIZE</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="c1"># sieve of eratosthenes</span>
<span class="k">def</span> <span class="nf">SOE</span><span class="p">(</span><span class="n">primelst</span><span class="p">):</span>
    <span class="n">is_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">MAX_SIZE</span><span class="p">)</span>

    <span class="n">prime</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">prime</span> <span class="o">*</span> <span class="n">prime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">[</span><span class="n">prime</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">prime</span> <span class="o">*</span> <span class="n">prime</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
                <span class="n">is_prime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="n">prime</span>
        <span class="n">prime</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">prime</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">prime</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">[</span><span class="n">prime</span><span class="p">]:</span>
            <span class="n">primelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prime</span><span class="p">)</span>

        <span class="n">prime</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">primelst</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">SOE</span><span class="p">([])</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10001</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<span class="c1"># 104743</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##8-largest-product-in-a-series-py'>#8-largest-product-in-a-series.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#8-largest-product-in-a-series.py' name='#8-largest-product-in-a-series-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-11</span>

<span class="sd">"""</span>
<span class="sd">Largest product in a series</span>

<span class="sd">The four adjacent digits in the 1000-digit number that </span>
<span class="sd">have the greatest product are 9  9  8  9 = 5832.</span>

<span class="sd">73167176531330624919225119674426574742355349194934</span>
<span class="sd">96983520312774506326239578318016984801869478851843</span>
<span class="sd">85861560789112949495459501737958331952853208805511</span>
<span class="sd">12540698747158523863050715693290963295227443043557</span>
<span class="sd">66896648950445244523161731856403098711121722383113</span>
<span class="sd">62229893423380308135336276614282806444486645238749</span>
<span class="sd">30358907296290491560440772390713810515859307960866</span>
<span class="sd">70172427121883998797908792274921901699720888093776</span>
<span class="sd">65727333001053367881220235421809751254540594752243</span>
<span class="sd">52584907711670556013604839586446706324415722155397</span>
<span class="sd">53697817977846174064955149290862569321978468622482</span>
<span class="sd">83972241375657056057490261407972968652414535100474</span>
<span class="sd">82166370484403199890008895243450658541227588666881</span>
<span class="sd">16427171479924442928230863465674813919123162824586</span>
<span class="sd">17866458359124566529476545682848912883142607690042</span>
<span class="sd">24219022671055626321111109370544217506941658960408</span>
<span class="sd">07198403850962455444362981230987879927244284909188</span>
<span class="sd">84580156166097919133875499200524063689912560717606</span>
<span class="sd">05886116467109405077541002256983155200055935729725</span>
<span class="sd">71636269561882670428252483600823257530420752963450</span>

<span class="sd">Find the thirteen adjacent digits in the 1000-digit </span>
<span class="sd">number that have the greatest product. What is the</span>
<span class="sd">value of this product?</span>

<span class="sd">https://projecteuler.net/problem=8</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">str</span> <span class="o">=</span> <span class="s1">'''</span>
<span class="s1">73167176531330624919225119674426574742355349194934</span>
<span class="s1">96983520312774506326239578318016984801869478851843</span>
<span class="s1">85861560789112949495459501737958331952853208805511</span>
<span class="s1">12540698747158523863050715693290963295227443043557</span>
<span class="s1">66896648950445244523161731856403098711121722383113</span>
<span class="s1">62229893423380308135336276614282806444486645238749</span>
<span class="s1">30358907296290491560440772390713810515859307960866</span>
<span class="s1">70172427121883998797908792274921901699720888093776</span>
<span class="s1">65727333001053367881220235421809751254540594752243</span>
<span class="s1">52584907711670556013604839586446706324415722155397</span>
<span class="s1">53697817977846174064955149290862569321978468622482</span>
<span class="s1">83972241375657056057490261407972968652414535100474</span>
<span class="s1">82166370484403199890008895243450658541227588666881</span>
<span class="s1">16427171479924442928230863465674813919123162824586</span>
<span class="s1">17866458359124566529476545682848912883142607690042</span>
<span class="s1">24219022671055626321111109370544217506941658960408</span>
<span class="s1">07198403850962455444362981230987879927244284909188</span>
<span class="s1">84580156166097919133875499200524063689912560717606</span>
<span class="s1">05886116467109405077541002256983155200055935729725</span>
<span class="s1">71636269561882670428252483600823257530420752963450</span>
<span class="s1">'''</span>

<span class="n">nlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)))</span>
<span class="n">nlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">nlist</span><span class="p">))</span>

<span class="c1"># test</span>
<span class="c1"># adj_digits = 4</span>
<span class="c1"># max_product = 0</span>
<span class="c1"># for i in range(len(nlist)):</span>
<span class="c1">#     if (i + adj_digits &gt; len(nlist)):</span>
<span class="c1">#         break</span>
<span class="c1">#     product = np.prod(nlist[i:i+adj_digits])</span>
<span class="c1">#     if product &gt; max_product:</span>
<span class="c1">#         max_product = product</span>

<span class="c1"># assert(max_product == 5832)</span>

<span class="c1"># solution</span>
<span class="n">adj_digits</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">max_product</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nlist</span><span class="p">)):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">adj_digits</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">nlist</span><span class="p">)):</span>
        <span class="k">break</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">nlist</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">adj_digits</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">product</span> <span class="o">&gt;</span> <span class="n">max_product</span><span class="p">:</span>
        <span class="n">max_product</span> <span class="o">=</span> <span class="n">product</span>

<span class="nb">print</span><span class="p">(</span><span class="n">max_product</span><span class="p">)</span>
<span class="c1"># 23514624000</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##9-special-pythagorean-triplet-py'>#9-special-pythagorean-triplet.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#9-special-pythagorean-triplet.py' name='#9-special-pythagorean-triplet-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2020-11</span>

<span class="sd">"""</span>
<span class="sd">Special Pythagorean triplet</span>

<span class="sd">A Pythagorean triplet is a set of three </span>
<span class="sd">natural numbers, a &lt; b &lt; c, for which,</span>
<span class="sd">a^2 + b^2 = c^2.</span>

<span class="sd">For example, 3^2 + 4^2 = 9 + 16 = 25 = 5^2.</span>

<span class="sd">There exists exactly one Pythagorean triplet </span>
<span class="sd">for which a + b + c = 1000. Find the product </span>
<span class="sd">abc.</span>

<span class="sd">https://projecteuler.net/problem=9</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># it is not pretty, but it works</span>
<span class="n">MAX_N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="k">def</span> <span class="nf">brute</span><span class="p">(</span><span class="n">MAX_N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_N</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_N</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_N</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span>

    <span class="k">return</span> <span class="mi">0</span>

<span class="n">triplet</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">brute</span><span class="p">(</span><span class="n">MAX_N</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">triplet</span><span class="p">)</span>
<span class="c1"># (200, 375, 425)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1"># 31875000</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##10-summation-of-primes-py'>#10-summation-of-primes.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#10-summation-of-primes.py' name='#10-summation-of-primes-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Summation of primes</span>

<span class="sd">The sum of the primes below 10 is 2 + 3 + 5 + 7 = 17.</span>

<span class="sd">Find the sum of all the primes below two million.</span>

<span class="sd">https://projecteuler.net/problem=10</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># sieve of eratosthenes</span>
<span class="k">def</span> <span class="nf">SOE</span><span class="p">(</span><span class="n">primelst</span><span class="p">,</span> <span class="n">MAX_SIZE</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">is_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">MAX_SIZE</span><span class="p">)</span>

    <span class="n">prime</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">prime</span> <span class="o">*</span> <span class="n">prime</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">[</span><span class="n">prime</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">prime</span> <span class="o">*</span> <span class="n">prime</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
                <span class="n">is_prime</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="n">prime</span>
        <span class="n">prime</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">prime</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">prime</span> <span class="o">&lt;</span> <span class="n">MAX_SIZE</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_prime</span><span class="p">[</span><span class="n">prime</span><span class="p">]:</span> <span class="n">primelst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prime</span><span class="p">)</span>
        <span class="n">prime</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">primelst</span>

<span class="k">assert</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">SOE</span><span class="p">([],</span> <span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="mi">17</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">SOE</span><span class="p">([],</span> <span class="mi">2000000</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">result</span><span class="p">))</span> <span class="c1"># 142913828922</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##11-largest-product-in-grid-py'>#11-largest-product-in-grid.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#11-largest-product-in-grid.py' name='#11-largest-product-in-grid-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Largest product in grid</span>

<span class="sd">In the 20x20 grid below, four numbers along a diagonal line</span>
<span class="sd">have been marked in red.</span>

<span class="sd">The product of these numbers is 26 * 63 * 78 * 14 = 1788696.</span>

<span class="sd">What is the greatest product of four adjacent numbers in the </span>
<span class="sd">same direction (up, down, left, right, or diagonally) in the </span>
<span class="sd">20x20 grid?</span>

<span class="sd">https://projecteuler.net/problem=11</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># solution</span>
<span class="n">GRID</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">'08'</span><span class="p">,</span> <span class="s1">'02'</span><span class="p">,</span> <span class="s1">'22'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">,</span> <span class="s1">'38'</span><span class="p">,</span> <span class="s1">'15'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'75'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'07'</span><span class="p">,</span> <span class="s1">'78'</span><span class="p">,</span> <span class="s1">'52'</span><span class="p">,</span> <span class="s1">'12'</span><span class="p">,</span> <span class="s1">'50'</span><span class="p">,</span> <span class="s1">'77'</span><span class="p">,</span> <span class="s1">'91'</span><span class="p">,</span> <span class="s1">'08'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'49'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'81'</span><span class="p">,</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">,</span> <span class="s1">'60'</span><span class="p">,</span> <span class="s1">'87'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'98'</span><span class="p">,</span> <span class="s1">'43'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'48'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'81'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">,</span> <span class="s1">'79'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'29'</span><span class="p">,</span> <span class="s1">'93'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">,</span> <span class="s1">'30'</span><span class="p">,</span> <span class="s1">'03'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'65'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'52'</span><span class="p">,</span> <span class="s1">'70'</span><span class="p">,</span> <span class="s1">'95'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'60'</span><span class="p">,</span> <span class="s1">'11'</span><span class="p">,</span> <span class="s1">'42'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'24'</span><span class="p">,</span> <span class="s1">'68'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">,</span> <span class="s1">'01'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'37'</span><span class="p">,</span> <span class="s1">'02'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'91'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'22'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'51'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">,</span> <span class="s1">'41'</span><span class="p">,</span> <span class="s1">'92'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'22'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'28'</span><span class="p">,</span> <span class="s1">'66'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'80'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'24'</span><span class="p">,</span> <span class="s1">'47'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'60'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">,</span> <span class="s1">'03'</span><span class="p">,</span> <span class="s1">'45'</span><span class="p">,</span> <span class="s1">'02'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">,</span> <span class="s1">'75'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">,</span> <span class="s1">'78'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'84'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'12'</span><span class="p">,</span> <span class="s1">'50'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'32'</span><span class="p">,</span> <span class="s1">'98'</span><span class="p">,</span> <span class="s1">'81'</span><span class="p">,</span> <span class="s1">'28'</span><span class="p">,</span> <span class="s1">'64'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'10'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">,</span> <span class="s1">'38'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'59'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'70'</span><span class="p">,</span> <span class="s1">'66'</span><span class="p">,</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'38'</span><span class="p">,</span> <span class="s1">'64'</span><span class="p">,</span> <span class="s1">'70'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'67'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="s1">'68'</span><span class="p">,</span> <span class="s1">'02'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'12'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="s1">'95'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'39'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">,</span> <span class="s1">'08'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'91'</span><span class="p">,</span> <span class="s1">'66'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'21'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'24'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'66'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'78'</span><span class="p">,</span> <span class="s1">'78'</span><span class="p">,</span> <span class="s1">'96'</span><span class="p">,</span> <span class="s1">'83'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">,</span> <span class="s1">'34'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">,</span> <span class="s1">'72'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'21'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">,</span> <span class="s1">'09'</span><span class="p">,</span> <span class="s1">'75'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'76'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="s1">'45'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'61'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">,</span> <span class="s1">'34'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'95'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'78'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">,</span> <span class="s1">'28'</span><span class="p">,</span> <span class="s1">'22'</span><span class="p">,</span> <span class="s1">'75'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'15'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'03'</span><span class="p">,</span> <span class="s1">'80'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'14'</span><span class="p">,</span> <span class="s1">'09'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">,</span> <span class="s1">'92'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'16'</span><span class="p">,</span> <span class="s1">'39'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'42'</span><span class="p">,</span> <span class="s1">'96'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'47'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">,</span> <span class="s1">'24'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'24'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'29'</span><span class="p">,</span> <span class="s1">'85'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'86'</span><span class="p">,</span> <span class="s1">'56'</span><span class="p">,</span> <span class="s1">'00'</span><span class="p">,</span> <span class="s1">'48'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">,</span> <span class="s1">'07'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">,</span> <span class="s1">'37'</span><span class="p">,</span> <span class="s1">'44'</span><span class="p">,</span> <span class="s1">'60'</span><span class="p">,</span> <span class="s1">'21'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">,</span> <span class="s1">'51'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'58'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'19'</span><span class="p">,</span> <span class="s1">'80'</span><span class="p">,</span> <span class="s1">'81'</span><span class="p">,</span> <span class="s1">'68'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'47'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'28'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">,</span> <span class="s1">'92'</span><span class="p">,</span> <span class="s1">'13'</span><span class="p">,</span> <span class="s1">'86'</span><span class="p">,</span> <span class="s1">'52'</span><span class="p">,</span> <span class="s1">'17'</span><span class="p">,</span> <span class="s1">'77'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'04'</span><span class="p">,</span> <span class="s1">'52'</span><span class="p">,</span> <span class="s1">'08'</span><span class="p">,</span> <span class="s1">'83'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'07'</span><span class="p">,</span> <span class="s1">'97'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">,</span> <span class="s1">'26'</span><span class="p">,</span> <span class="s1">'79'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'27'</span><span class="p">,</span> <span class="s1">'98'</span><span class="p">,</span> <span class="s1">'66'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'88'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'68'</span><span class="p">,</span> <span class="s1">'87'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'20'</span><span class="p">,</span> <span class="s1">'72'</span><span class="p">,</span> <span class="s1">'03'</span><span class="p">,</span> <span class="s1">'46'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'46'</span><span class="p">,</span> <span class="s1">'55'</span><span class="p">,</span> <span class="s1">'12'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'63'</span><span class="p">,</span> <span class="s1">'93'</span><span class="p">,</span> <span class="s1">'53'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'04'</span><span class="p">,</span> <span class="s1">'42'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">,</span> <span class="s1">'38'</span><span class="p">,</span> <span class="s1">'25'</span><span class="p">,</span> <span class="s1">'39'</span><span class="p">,</span> <span class="s1">'11'</span><span class="p">,</span> <span class="s1">'24'</span><span class="p">,</span> <span class="s1">'94'</span><span class="p">,</span> <span class="s1">'72'</span><span class="p">,</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'08'</span><span class="p">,</span> <span class="s1">'46'</span><span class="p">,</span> <span class="s1">'29'</span><span class="p">,</span> <span class="s1">'32'</span><span class="p">,</span> <span class="s1">'40'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'76'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'20'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'41'</span><span class="p">,</span> <span class="s1">'72'</span><span class="p">,</span> <span class="s1">'30'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">,</span> <span class="s1">'88'</span><span class="p">,</span> <span class="s1">'34'</span><span class="p">,</span> <span class="s1">'62'</span><span class="p">,</span> <span class="s1">'99'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'82'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'59'</span><span class="p">,</span> <span class="s1">'85'</span><span class="p">,</span> <span class="s1">'74'</span><span class="p">,</span> <span class="s1">'04'</span><span class="p">,</span> <span class="s1">'36'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'20'</span><span class="p">,</span> <span class="s1">'73'</span><span class="p">,</span> <span class="s1">'35'</span><span class="p">,</span> <span class="s1">'29'</span><span class="p">,</span> <span class="s1">'78'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'90'</span><span class="p">,</span> <span class="s1">'01'</span><span class="p">,</span> <span class="s1">'74'</span><span class="p">,</span> <span class="s1">'31'</span><span class="p">,</span> <span class="s1">'49'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'48'</span><span class="p">,</span> <span class="s1">'86'</span><span class="p">,</span> <span class="s1">'81'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'23'</span><span class="p">,</span> <span class="s1">'57'</span><span class="p">,</span> <span class="s1">'05'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">'01'</span><span class="p">,</span> <span class="s1">'70'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'71'</span><span class="p">,</span> <span class="s1">'83'</span><span class="p">,</span> <span class="s1">'51'</span><span class="p">,</span> <span class="s1">'54'</span><span class="p">,</span> <span class="s1">'69'</span><span class="p">,</span> <span class="s1">'16'</span><span class="p">,</span> <span class="s1">'92'</span><span class="p">,</span> <span class="s1">'33'</span><span class="p">,</span> <span class="s1">'48'</span><span class="p">,</span> <span class="s1">'61'</span><span class="p">,</span> <span class="s1">'43'</span><span class="p">,</span> <span class="s1">'52'</span><span class="p">,</span> <span class="s1">'01'</span><span class="p">,</span> <span class="s1">'89'</span><span class="p">,</span> <span class="s1">'19'</span><span class="p">,</span> <span class="s1">'67'</span><span class="p">,</span> <span class="s1">'48'</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">GRID</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GRID</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">WINDOW_SIZE</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># largest product</span>
<span class="k">def</span> <span class="nf">largest_product</span><span class="p">(</span><span class="n">GRID</span><span class="p">):</span>
    <span class="n">max_product</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">WINDOW_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">GRID</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">WINDOW_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GRID</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">WINDOW_SIZE</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span><span class="n">WINDOW_SIZE</span> <span class="o">+</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">windowT</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># print(window)</span>
            <span class="c1"># print(windowT)</span>

            <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># rows and columns</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="c1"># rows</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
                <span class="c1"># columns</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">windowT</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>

            <span class="c1"># diagonal</span>
            <span class="n">diagonal</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">diagonal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
            <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">diagonal</span><span class="p">))</span>

            <span class="c1"># diagonal: reversed</span>
            <span class="n">diagonal_reversed</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">windowT</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">diagonal_reversed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">window</span><span class="p">[(</span><span class="n">WINDOW_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
            <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">diagonal_reversed</span><span class="p">))</span>

            <span class="c1"># window max product</span>
            <span class="n">window_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">window_max</span> <span class="o">&gt;</span> <span class="n">max_product</span><span class="p">:</span>
                <span class="n">max_product</span> <span class="o">=</span> <span class="n">window_max</span>

    <span class="k">return</span> <span class="n">max_product</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">largest_product</span><span class="p">(</span><span class="n">GRID</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="c1"># 70600674</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##12-highly-divisible-triangular-number-py'>#12-highly-divisible-triangular-number.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#12-highly-divisible-triangular-number.py' name='#12-highly-divisible-triangular-number-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Highly divisible triangular number</span>

<span class="sd">The sequence of triangle numbers is generated by adding the natural numbers. So the </span>
<span class="sd">7th triangle number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms </span>
<span class="sd">would be: 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, ...</span>

<span class="sd">Let us list the factors of the first seven triangle numbers:</span>

<span class="sd">1  : 1</span>
<span class="sd">3  : 1,3</span>
<span class="sd">6  : 1,2,3,6</span>
<span class="sd">10 : 1,2,5,10</span>
<span class="sd">15 : 1,3,5,15</span>
<span class="sd">21 : 1,3,7,21</span>
<span class="sd">28 : 1,2,4,7,14,28</span>

<span class="sd">We can see that 28 is the first triangle number to have over five divisors.</span>

<span class="sd">What is the value of the first triangle number to have over five hundred divisors?</span>

<span class="sd">https://projecteuler.net/problem=12</span>
<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">triangle_number</span><span class="p">(</span><span class="n">number</span><span class="p">):</span> <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>

<span class="c1"># test (slow)</span>

<span class="k">def</span> <span class="nf">factors</span><span class="p">(</span><span class="n">factor_lst</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
    <span class="c1"># append known factors</span>
    <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># set first factor (no factor larger than number / 2)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">number</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="n">factor</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor_lst</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">triangle_number</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">28</span>
<span class="k">assert</span> <span class="n">factors</span><span class="p">([],</span> <span class="mi">28</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>

<span class="c1"># solution</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">factors_fast</span><span class="p">(</span><span class="n">factor_lst</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">factor</span> <span class="o">&lt;=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">/</span> <span class="n">factor</span> <span class="o">==</span> <span class="n">factor</span><span class="p">:</span> <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
                <span class="n">factor_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">factor</span><span class="p">))</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor_lst</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">factors_fast</span><span class="p">([],</span> <span class="mi">28</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span>

<span class="n">MAX_RANGE</span> <span class="o">=</span> <span class="mi">15000</span>
<span class="n">MIN_LEN</span> <span class="o">=</span> <span class="mi">500</span>

<span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_RANGE</span><span class="p">):</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">triangle_number</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">factors_fast</span><span class="p">([],</span> <span class="n">tn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="n">MIN_LEN</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tn</span><span class="p">,</span> <span class="n">f</span>
        <span class="k">break</span>

<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># 76576500</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##13-large-sum-py'>#13-large-sum.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#13-large-sum.py' name='#13-large-sum-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2022-07</span>

<span class="sd">"""</span>
<span class="sd">Large sum</span>

<span class="sd">Work out the first ten digits of the sum of the following one-hundred 50-digit numbers.</span>

<span class="sd">https://projecteuler.net/problem=13</span>
<span class="sd">"""</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="s2">"""37107287533902102798797998220837590246510135740250</span>
<span class="s2">46376937677490009712648124896970078050417018260538</span>
<span class="s2">74324986199524741059474233309513058123726617309629</span>
<span class="s2">91942213363574161572522430563301811072406154908250</span>
<span class="s2">23067588207539346171171980310421047513778063246676</span>
<span class="s2">89261670696623633820136378418383684178734361726757</span>
<span class="s2">28112879812849979408065481931592621691275889832738</span>
<span class="s2">44274228917432520321923589422876796487670272189318</span>
<span class="s2">47451445736001306439091167216856844588711603153276</span>
<span class="s2">70386486105843025439939619828917593665686757934951</span>
<span class="s2">62176457141856560629502157223196586755079324193331</span>
<span class="s2">64906352462741904929101432445813822663347944758178</span>
<span class="s2">92575867718337217661963751590579239728245598838407</span>
<span class="s2">58203565325359399008402633568948830189458628227828</span>
<span class="s2">80181199384826282014278194139940567587151170094390</span>
<span class="s2">35398664372827112653829987240784473053190104293586</span>
<span class="s2">86515506006295864861532075273371959191420517255829</span>
<span class="s2">71693888707715466499115593487603532921714970056938</span>
<span class="s2">54370070576826684624621495650076471787294438377604</span>
<span class="s2">53282654108756828443191190634694037855217779295145</span>
<span class="s2">36123272525000296071075082563815656710885258350721</span>
<span class="s2">45876576172410976447339110607218265236877223636045</span>
<span class="s2">17423706905851860660448207621209813287860733969412</span>
<span class="s2">81142660418086830619328460811191061556940512689692</span>
<span class="s2">51934325451728388641918047049293215058642563049483</span>
<span class="s2">62467221648435076201727918039944693004732956340691</span>
<span class="s2">15732444386908125794514089057706229429197107928209</span>
<span class="s2">55037687525678773091862540744969844508330393682126</span>
<span class="s2">18336384825330154686196124348767681297534375946515</span>
<span class="s2">80386287592878490201521685554828717201219257766954</span>
<span class="s2">78182833757993103614740356856449095527097864797581</span>
<span class="s2">16726320100436897842553539920931837441497806860984</span>
<span class="s2">48403098129077791799088218795327364475675590848030</span>
<span class="s2">87086987551392711854517078544161852424320693150332</span>
<span class="s2">59959406895756536782107074926966537676326235447210</span>
<span class="s2">69793950679652694742597709739166693763042633987085</span>
<span class="s2">41052684708299085211399427365734116182760315001271</span>
<span class="s2">65378607361501080857009149939512557028198746004375</span>
<span class="s2">35829035317434717326932123578154982629742552737307</span>
<span class="s2">94953759765105305946966067683156574377167401875275</span>
<span class="s2">88902802571733229619176668713819931811048770190271</span>
<span class="s2">25267680276078003013678680992525463401061632866526</span>
<span class="s2">36270218540497705585629946580636237993140746255962</span>
<span class="s2">24074486908231174977792365466257246923322810917141</span>
<span class="s2">91430288197103288597806669760892938638285025333403</span>
<span class="s2">34413065578016127815921815005561868836468420090470</span>
<span class="s2">23053081172816430487623791969842487255036638784583</span>
<span class="s2">11487696932154902810424020138335124462181441773470</span>
<span class="s2">63783299490636259666498587618221225225512486764533</span>
<span class="s2">67720186971698544312419572409913959008952310058822</span>
<span class="s2">95548255300263520781532296796249481641953868218774</span>
<span class="s2">76085327132285723110424803456124867697064507995236</span>
<span class="s2">37774242535411291684276865538926205024910326572967</span>
<span class="s2">23701913275725675285653248258265463092207058596522</span>
<span class="s2">29798860272258331913126375147341994889534765745501</span>
<span class="s2">18495701454879288984856827726077713721403798879715</span>
<span class="s2">38298203783031473527721580348144513491373226651381</span>
<span class="s2">34829543829199918180278916522431027392251122869539</span>
<span class="s2">40957953066405232632538044100059654939159879593635</span>
<span class="s2">29746152185502371307642255121183693803580388584903</span>
<span class="s2">41698116222072977186158236678424689157993532961922</span>
<span class="s2">62467957194401269043877107275048102390895523597457</span>
<span class="s2">23189706772547915061505504953922979530901129967519</span>
<span class="s2">86188088225875314529584099251203829009407770775672</span>
<span class="s2">11306739708304724483816533873502340845647058077308</span>
<span class="s2">82959174767140363198008187129011875491310547126581</span>
<span class="s2">97623331044818386269515456334926366572897563400500</span>
<span class="s2">42846280183517070527831839425882145521227251250327</span>
<span class="s2">55121603546981200581762165212827652751691296897789</span>
<span class="s2">32238195734329339946437501907836945765883352399886</span>
<span class="s2">75506164965184775180738168837861091527357929701337</span>
<span class="s2">62177842752192623401942399639168044983993173312731</span>
<span class="s2">32924185707147349566916674687634660915035914677504</span>
<span class="s2">99518671430235219628894890102423325116913619626622</span>
<span class="s2">73267460800591547471830798392868535206946944540724</span>
<span class="s2">76841822524674417161514036427982273348055556214818</span>
<span class="s2">97142617910342598647204516893989422179826088076852</span>
<span class="s2">87783646182799346313767754307809363333018982642090</span>
<span class="s2">10848802521674670883215120185883543223812876952786</span>
<span class="s2">71329612474782464538636993009049310363619763878039</span>
<span class="s2">62184073572399794223406235393808339651327408011116</span>
<span class="s2">66627891981488087797941876876144230030984490851411</span>
<span class="s2">60661826293682836764744779239180335110989069790714</span>
<span class="s2">85786944089552990653640447425576083659976645795096</span>
<span class="s2">66024396409905389607120198219976047599490197230297</span>
<span class="s2">64913982680032973156037120041377903785566085089252</span>
<span class="s2">16730939319872750275468906903707539413042652315011</span>
<span class="s2">94809377245048795150954100921645863754710598436791</span>
<span class="s2">78639167021187492431995700641917969777599028300699</span>
<span class="s2">15368713711936614952811305876380278410754449733078</span>
<span class="s2">40789923115535562561142322423255033685442488917353</span>
<span class="s2">44889911501440648020369068063960672322193204149535</span>
<span class="s2">41503128880339536053299340368006977710650566631954</span>
<span class="s2">81234880673210146739058568557934581403627822703280</span>
<span class="s2">82616570773948327592232845941706525094512325230608</span>
<span class="s2">22918802058777319719839450180888072429661980811197</span>
<span class="s2">77158542502016545090413245809786882778948721859617</span>
<span class="s2">72107838435069186155435662884062257473692284509516</span>
<span class="s2">20849603980134001723930671666823555245252804609722</span>
<span class="s2">53503534226472524250874054075591789781264330331690"""</span>

<span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">numbers</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
<span class="c1"># 5537376230</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##14-longest-collatz-sequence-py'>#14-longest-collatz-sequence.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#14-longest-collatz-sequence.py' name='#14-longest-collatz-sequence-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2022-07</span>

<span class="sd">"""</span>
<span class="sd">Longest Collatz sequence</span>

<span class="sd">The following iterative sequence is defined for the set of positive integers:</span>

<span class="sd">  n -&gt; n / 2 (n is even)</span>
<span class="sd">  n -&gt; 3n + 1 (n is odd)</span>

<span class="sd">Using the rule above and starting with 13, we generate the following sequence:</span>

<span class="sd">  13 -&gt; 40 -&gt; 20 -&gt; 10 -&gt; 5 -&gt; 16 -&gt; 8 -&gt; 4 -&gt; 2 -&gt; 1</span>

<span class="sd">It can be seen that this sequence (starting at 13 and finishing at 1) contains </span>
<span class="sd">10 terms. Although it has not been proved yet (Collatz Problem), it is thought </span>
<span class="sd">that all starting numbers finish at 1.</span>

<span class="sd">Which starting number, under one million, produces the longest chain?</span>

<span class="sd">https://projecteuler.net/problem=14</span>
<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">collatz</span><span class="p">(</span><span class="n">seq_lst</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="c1"># append starting value</span>
    <span class="n">seq_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># even</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">seq_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="c1"># odd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">seq_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">seq_lst</span>

<span class="k">assert</span> <span class="n">collatz</span><span class="p">([],</span> <span class="mi">13</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># solution (slow)</span>

<span class="n">MAX_RANGE</span> <span class="o">=</span> <span class="mi">1000000</span>

<span class="n">longest</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_RANGE</span><span class="p">):</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="n">collatz</span><span class="p">([],</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">longest</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">longest</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">longest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># 837799</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##15-lattice-paths-py'>#15-lattice-paths.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#15-lattice-paths.py' name='#15-lattice-paths-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2022-07</span>

<span class="sd">"""</span>
<span class="sd">Lattice paths</span>

<span class="sd">Starting in the top left corner of a 22 grid, and only being able to </span>
<span class="sd">move to the right and down, there are exactly 6 routes to the bottom </span>
<span class="sd">right corner.</span>

<span class="sd">How many such routes are there through a 2020 grid?</span>

<span class="sd">https://projecteuler.net/problem=15</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="sd">"""</span>
<span class="sd">pascal triangle (2x2 -&gt; 3x3 grid line): 6 paths</span>
<span class="sd">1 1 1</span>
<span class="sd">1 2 3</span>
<span class="sd">1 3 6</span>

<span class="sd">pascal triangle (3x3 -&gt; 4x4 grid line) : 20 paths</span>
<span class="sd">1 1  1  1</span>
<span class="sd">1 2  3  4</span>
<span class="sd">1 3  6 10</span>
<span class="sd">1 4 10 20</span>
<span class="sd">"""</span>

<span class="c1"># https://en.wikipedia.org/wiki/Pascal%27s_triangle</span>
<span class="k">def</span> <span class="nf">pascal_triangle</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">grid</span>

<span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">pascal_triangle</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span>
<span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">pascal_triangle</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">20</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">pascal_triangle</span><span class="p">(</span><span class="mi">21</span><span class="p">)[</span><span class="mi">20</span><span class="p">][</span><span class="mi">20</span><span class="p">]))</span>
<span class="c1"># 137846528820</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##16-power-digit-sum-py'>#16-power-digit-sum.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#16-power-digit-sum.py' name='#16-power-digit-sum-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2022-07</span>

<span class="sd">"""</span>
<span class="sd">Power digit sum</span>

<span class="sd">2^15 = 32768 and the sum of its digits is 3 + 2 + 7 + 6 + 8 = 26.</span>

<span class="sd">What is the sum of the digits of the number 2^1000?</span>

<span class="sd">https://projecteuler.net/problem=16</span>
<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">pow_sum</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="n">p</span><span class="p">)))))</span>

<span class="k">assert</span> <span class="n">pow_sum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="mi">26</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pow_sum</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="c1"># 1366</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='##17-number-letter-counts-py'>#17-number-letter-counts.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/euler/#17-number-letter-counts.py' name='#17-number-letter-counts-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># 2022-07</span>

<span class="sd">"""</span>
<span class="sd">Number letter counts</span>

<span class="sd">If the numbers 1 to 5 are written out in words: one, two, three,</span>
<span class="sd">four, five, then there are 3 + 3 + 5 + 4 + 4 = 19 letters used in</span>
<span class="sd">total.</span>

<span class="sd">If all the numbers from 1 to 1000 (one thousand) inclusive were</span>
<span class="sd">written out in words, how many letters would be used?</span>

<span class="sd">https://projecteuler.net/problem=17</span>
<span class="sd">"""</span>

<span class="n">words</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">'one'</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">'two'</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">'three'</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s1">'four'</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s1">'five'</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s1">'six'</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s1">'seven'</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s1">'eight'</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s1">'nine'</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s1">'ten'</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s1">'eleven'</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s1">'twelve'</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s1">'thirteen'</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s1">'fourteen'</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="s1">'fifteen'</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="s1">'sixteen'</span><span class="p">,</span>
    <span class="mi">17</span><span class="p">:</span> <span class="s1">'seventeen'</span><span class="p">,</span>
    <span class="mi">18</span><span class="p">:</span> <span class="s1">'eighteen'</span><span class="p">,</span>
    <span class="mi">19</span><span class="p">:</span> <span class="s1">'nineteen'</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">:</span> <span class="s1">'twenty'</span><span class="p">,</span>
    <span class="mi">30</span><span class="p">:</span> <span class="s1">'thirty'</span><span class="p">,</span>
    <span class="mi">40</span><span class="p">:</span> <span class="s1">'forty'</span><span class="p">,</span>
    <span class="mi">50</span><span class="p">:</span> <span class="s1">'fifty'</span><span class="p">,</span>
    <span class="mi">60</span><span class="p">:</span> <span class="s1">'sixty'</span><span class="p">,</span>
    <span class="mi">70</span><span class="p">:</span> <span class="s1">'seventy'</span><span class="p">,</span>
    <span class="mi">80</span><span class="p">:</span> <span class="s1">'eighty'</span><span class="p">,</span>
    <span class="mi">90</span><span class="p">:</span> <span class="s1">'ninety'</span><span class="p">,</span>
    <span class="mi">100</span><span class="p">:</span> <span class="s1">'hundred'</span><span class="p">,</span>
    <span class="mi">1000</span><span class="p">:</span> <span class="s1">'thousand'</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">parse_number</span><span class="p">(</span><span class="n">word_lst</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">number</span><span class="p">)):</span>
        <span class="n">digit</span> <span class="o">=</span> <span class="n">number</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># convert to teens</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="n">number</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'and'</span><span class="p">)</span>
            <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="n">number</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])])</span>
            <span class="k">break</span>
        <span class="c1"># convert to tens</span>
        <span class="k">elif</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="s1">'0'</span><span class="p">)</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'and'</span><span class="p">)</span>
            <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span> <span class="o">+</span> <span class="s1">'0'</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span><span class="p">)])</span>
        <span class="c1"># thousands</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1000</span><span class="p">])</span>
            <span class="k">break</span>
        <span class="c1"># hundreds</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">word_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
        <span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">word_lst</span>

<span class="k">assert</span> <span class="n">parse_number</span><span class="p">([],</span> <span class="mi">342</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'three'</span><span class="p">,</span> <span class="s1">'hundred'</span><span class="p">,</span> <span class="s1">'and'</span><span class="p">,</span> <span class="s1">'forty'</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">parse_number</span><span class="p">([],</span> <span class="mi">115</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'one'</span><span class="p">,</span> <span class="s1">'hundred'</span><span class="p">,</span> <span class="s1">'and'</span><span class="p">,</span> <span class="s1">'fifteen'</span><span class="p">]</span>

<span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">parse_number</span><span class="p">([],</span> <span class="mi">342</span><span class="p">))))</span> <span class="o">==</span> <span class="mi">23</span>
<span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">parse_number</span><span class="p">([],</span> <span class="mi">115</span><span class="p">))))</span> <span class="o">==</span> <span class="mi">20</span>

<span class="c1"># numbers = []</span>
<span class="n">letters</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
    <span class="c1"># number = parse_number([], n)</span>
    <span class="c1"># numbers.append(number)</span>
    <span class="n">letters</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">parse_number</span><span class="p">([],</span> <span class="n">n</span><span class="p">))))</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span>
<span class="c1"># 21124</span>
</pre></div>
</div></div></div><a name='python-compilers'></a><h2>compilers<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#ast-constant-folding-py'>ast-constant-folding.py</a><a class='dotted' href='#ast-to-tac-to-llvm-py'>ast-to-tac-to-llvm.py</a><a class='dotted' href='#dsl-in-python-py'>dsl-in-python.py</a><a class='dotted' href='#for-loop-implementation-py'>for-loop-implementation.py</a><a class='dotted' href='#loop-tiling-optimization-py'>loop-tiling-optimization.py</a><a class='dotted' href='#opencl-in-python-py'>opencl-in-python.py</a><a class='dotted' href='#operator-fusion-on-parse-tree-py'>operator-fusion-on-parse-tree.py</a><a class='dotted' href='#parallelization-optimization-py'>parallelization-optimization.py</a><a class='dotted' href='#shunting-yard-algorithm-py'>shunting-yard-algorithm.py</a><a class='dotted' href='#tokenizer-using-generator-in-python-py'>tokenizer-using-generator-in-python.py</a><a class='dotted' href='#vectorization-optimization-py'>vectorization-optimization.py</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#ast-constant-folding-py'>ast-constant-folding.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/ast-constant-folding.py' name='ast-constant-folding-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Constant folding is a form of partial evaluation</span>
<span class="sd">that can be applied to constant expressions to</span>
<span class="sd">reduce the number of instructions in generated</span>
<span class="sd">code.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">ast</span>

<span class="n">program</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">x = 5</span>
<span class="s2">y = 10</span>
<span class="s2">z = x + y * 2</span>
<span class="s2">print(z)</span>
<span class="s2">"""</span>

<span class="n">variables</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
<span class="c1"># print(len(ast.dump(tree)))</span>
<span class="c1"># 449</span>

<span class="n">folded_tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="p">[],</span> <span class="n">type_ignores</span><span class="o">=</span><span class="p">[])</span>

<span class="c1"># walk ast</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">ast</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">):</span>
                <span class="n">variables</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">n</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">folded_tree</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">variables</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Num</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">variables</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folded_tree</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
        <span class="n">folded_tree</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

<span class="c1"># print(variables)</span>
<span class="c1"># print(ast.dump(folded_tree))</span>
<span class="c1"># print(len(ast.dump(folded_tree)))</span>
<span class="c1"># 295</span>

<span class="c1"># fix missing locations</span>
<span class="n">ast</span><span class="o">.</span><span class="n">fix_missing_locations</span><span class="p">(</span><span class="n">folded_tree</span><span class="p">)</span>

<span class="c1"># compile and execute folded tree</span>
<span class="n">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="n">folded_tree</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">"&lt;ast&gt;"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"exec"</span><span class="p">))</span>
<span class="c1"># 25</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#ast-to-tac-to-llvm-py'>ast-to-tac-to-llvm.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/ast-to-tac-to-llvm.py' name='ast-to-tac-to-llvm-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">AST is tree representation of source code</span>
<span class="sd">TAC is linear representation of ASTs</span>
<span class="sd">LLVM IR is linear representation of the TAC</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">mako.template</span> <span class="kn">import</span> <span class="n">Template</span>

<span class="k">def</span> <span class="nf">gen_tac</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">tmp_counter</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"t</span><span class="si">{</span><span class="n">tmp_counter</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">ast</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"t</span><span class="si">{</span><span class="n">tmp_counter</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">tmp_counter</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">ast</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">left_var</span><span class="p">,</span> <span class="n">tmp_counter</span> <span class="o">=</span> <span class="n">gen_tac</span><span class="p">(</span><span class="n">ast</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tmp_counter</span><span class="p">)</span>
        <span class="n">right</span><span class="p">,</span> <span class="n">right_var</span><span class="p">,</span> <span class="n">tmp_counter</span> <span class="o">=</span> <span class="n">gen_tac</span><span class="p">(</span><span class="n">ast</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tmp_counter</span><span class="p">)</span>
        <span class="n">tmp_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"t</span><span class="si">{</span><span class="n">tmp_counter</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">tmp_var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">left_var</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">right_var</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">tmp_var</span><span class="p">,</span> <span class="n">tmp_counter</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"unknown node"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tac_to_llvm</span><span class="p">(</span><span class="n">tac</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">var_map</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"define i32 @main(i32) {"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tac</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">):</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
        <span class="n">destination_var</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">operands</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">'='</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">operands</span> <span class="ow">and</span> <span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = add i32 </span><span class="si">{</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, 0"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = add i32 %</span><span class="si">{</span><span class="n">var_map</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">, 0"</span><span class="p">)</span>
            <span class="n">var_map</span><span class="p">[</span><span class="n">destination_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_var</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># replace assignment with operation</span>
            <span class="n">operation</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">op1</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op1</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"%</span><span class="si">{</span><span class="n">var_map</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">if</span> <span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">op2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"%</span><span class="si">{</span><span class="n">var_map</span><span class="p">[</span><span class="n">operands</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="si">}</span><span class="s2">"</span>

            <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">'+'</span><span class="p">:</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = add i32 </span><span class="si">{</span><span class="n">op1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">op2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">'-'</span><span class="p">:</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = sub i32 </span><span class="si">{</span><span class="n">op1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">op2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">'*'</span><span class="p">:</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = mul i32 </span><span class="si">{</span><span class="n">op1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">op2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">'/'</span><span class="p">:</span>
                <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">%</span><span class="si">{</span><span class="n">destination_var</span><span class="si">}</span><span class="s2"> = sdiv i32 </span><span class="si">{</span><span class="n">op1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">op2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unsupported operation: </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

            <span class="n">var_map</span><span class="p">[</span><span class="n">destination_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination_var</span>

    <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">ret i32 %</span><span class="si">{</span><span class="n">var_map</span><span class="p">[</span><span class="n">destination_var</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">code</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"}"</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

<span class="n">ast</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"+"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="s2">"*"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">tac</span> <span class="o">=</span> <span class="n">gen_tac</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># t1 = 2</span>
<span class="c1"># t2 = 3</span>
<span class="c1"># t3 = 4</span>
<span class="c1"># t4 = t2 * t3</span>
<span class="c1"># t5 = t1 + t4</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tac_to_llvm</span><span class="p">(</span><span class="n">tac</span><span class="p">))</span>
<span class="c1"># define i32 @main(i32) {</span>
<span class="c1">#     %t1 = add i32 2, 0</span>
<span class="c1">#     %t2 = add i32 3, 0</span>
<span class="c1">#     %t3 = add i32 4, 0</span>
<span class="c1">#     %t4 = mul i32 %t2, %t3</span>
<span class="c1">#     %t5 = add i32 %t1, %t4</span>
<span class="c1">#     ret i32 %t5</span>
<span class="c1"># }</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#dsl-in-python-py'>dsl-in-python.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/dsl-in-python.py' name='dsl-in-python-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">This is how to design and use embedded</span>
<span class="sd">domain-specific languages in Python.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="sd">"""</span>
<span class="sd">functions</span>
<span class="sd">    add     : sum all arguments</span>
<span class="sd">    sub     : subtract tail from head</span>
<span class="sd">types</span>
<span class="sd">    int</span>
<span class="sd">    float</span>
<span class="sd">arguments</span>
<span class="sd">    out     : stdin to use previous output as input</span>
<span class="sd">            : stdout to print</span>
<span class="sd">"""</span>
<span class="n">program</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">Module add 1 2 3 type=float out=stdin</span>
<span class="s2">Module sub stdin 1 2 type=int out=stdout</span>
<span class="s2">"""</span>

<span class="c1"># Module definition</span>
<span class="k">class</span> <span class="nc">Module</span><span class="p">:</span>
    <span class="c1"># Add function</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="s2">"__builtins__"</span><span class="p">]</span><span class="o">.</span><span class="n">getattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="s2">"__builtins__"</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"type"</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">args</span><span class="p">))</span>
    <span class="c1"># Sub function</span>
    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="s2">"__builtins__"</span><span class="p">]</span><span class="o">.</span><span class="n">getattr</span><span class="p">(</span><span class="nb">globals</span><span class="p">()[</span><span class="s2">"__builtins__"</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"type"</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">'float'</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">type_</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>

<span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">STDIN</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="c1"># kwargs</span>
        <span class="k">if</span> <span class="s1">'='</span> <span class="ow">in</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="c1"># args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># replace stdin with previous output</span>
            <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s2">"stdin"</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">STDIN</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">STDIN</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"no previous output"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>

<span class="k">def</span> <span class="nf">interpret</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
    <span class="n">STDIN</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">program</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="p">]</span>
    <span class="c1"># print(lines)</span>
    <span class="c1"># ['Module add 1 2 3 type=float out=stdin', 'Module sub stdin 1 2 type=int out=stdout']</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">STDIN</span><span class="p">)</span>

        <span class="c1"># print(args, kwargs)</span>
        <span class="c1"># ['1', '2', '3'] {'type': 'float', 'out': 'stdin'}</span>
        <span class="c1"># [6.0, '1', '2'] {'type': 'int', 'out': 'stdout'}</span>

        <span class="c1"># print(getattr(sys.modules[__name__], tokens[0]))</span>
        <span class="c1"># &lt;class '__main__.Module'&gt;</span>
        <span class="c1"># &lt;class '__main__.Module'&gt;</span>

        <span class="c1"># print(getattr(getattr(sys.modules[__name__], tokens[0]), tokens[1]))</span>
        <span class="c1"># &lt;function Module.add at 0x1024545e0&gt;</span>
        <span class="c1"># &lt;function Module.sub at 0x108ed9620&gt;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">"out"</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"out"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"stdin"</span><span class="p">:</span> <span class="n">STDIN</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">"out"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"stdout"</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">interpret</span><span class="p">(</span><span class="n">program</span><span class="p">)</span> <span class="c1"># 3</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#for-loop-implementation-py'>for-loop-implementation.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/for-loop-implementation.py' name='for-loop-implementation-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">timeit</span>

<span class="k">def</span> <span class="nf">not_for_loop</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">elements</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">operation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="n">not_for_loop</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">operation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">elements</span>

<span class="k">def</span> <span class="nf">for_loop_using_while</span><span class="p">(</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">operation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">elements</span>

<span class="k">def</span> <span class="nf">for_loop</span><span class="p">(</span><span class="n">elements</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">operation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
        <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">operation</span><span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">elements</span>

<span class="c1"># print(not_for_loop(0, [1, 2, 3, 4, 5], lambda x: x.__add__(1)))</span>
<span class="c1"># print(for_loop_using_while([1, 2, 3, 4, 5], lambda x: x.__add__(1)))</span>
<span class="c1"># print(for_loop([1, 2, 3, 4, 5], lambda x: x.__add__(1)))</span>

<span class="k">assert</span> <span class="n">not_for_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">for_loop_using_while</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">for_loop</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'not_for_loop(0, [1, 2, 3, 4, 5], lambda x: x.__add__(1))'</span><span class="p">,</span> <span class="n">setup</span> <span class="o">=</span> <span class="s1">'from __main__ import not_for_loop'</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">))</span>
<span class="c1"># 0.10954952286556363</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'for_loop_using_while([1, 2, 3, 4, 5], lambda x: x.__add__(1))'</span><span class="p">,</span> <span class="n">setup</span> <span class="o">=</span> <span class="s1">'from __main__ import for_loop_using_while'</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">))</span>
<span class="c1"># 0.08992556994780898</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'for_loop([1, 2, 3, 4, 5], lambda x: x.__add__(1))'</span><span class="p">,</span> <span class="n">setup</span> <span class="o">=</span> <span class="s1">'from __main__ import for_loop'</span><span class="p">,</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">))</span>
<span class="c1"># 0.08654258819296956</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#loop-tiling-optimization-py'>loop-tiling-optimization.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/loop-tiling-optimization.py' name='loop-tiling-optimization-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Loop tiling optimization is a technique used</span>
<span class="sd">to improve cache efficiency in nested loops.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="c1"># timeit.template = """</span>
<span class="c1"># def inner(_it, _timer{init}):</span>
<span class="c1">#     from tqdm import tqdm</span>
<span class="c1">#     {setup}</span>
<span class="c1">#     _t0 = _timer()</span>
<span class="c1">#     for _i in tqdm(_it, total=_it.__length_hint__()):</span>
<span class="c1">#         {stmt}</span>
<span class="c1">#     _t1 = _timer()</span>
<span class="c1">#     return _t1 - _t0</span>
<span class="c1"># """</span>

<span class="c1"># matrix multiplication</span>
<span class="k">def</span> <span class="nf">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>

<span class="k">assert</span> <span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="p">[[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span> <span class="p">[</span><span class="mi">84</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">54</span><span class="p">],</span> <span class="p">[</span><span class="mi">138</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">90</span><span class="p">]]</span>

<span class="c1"># tiling</span>
<span class="n">TILE_SIZE</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">def</span> <span class="nf">matmul_tiled</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">TILE_SIZE</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">TILE_SIZE</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">TILE_SIZE</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">TILE_SIZE</span><span class="p">,</span> <span class="n">m</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">TILE_SIZE</span><span class="p">,</span> <span class="n">p</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">TILE_SIZE</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">kk</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">assert</span> <span class="n">matmul_tiled</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">==</span> <span class="p">[[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span> <span class="p">[</span><span class="mi">84</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">54</span><span class="p">],</span> <span class="p">[</span><span class="mi">138</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">90</span><span class="p">]]</span>

<span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># 6.854414212051779</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">matmul_tiled</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># CPU</span>
<span class="c1"># 6.588905839016661</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#opencl-in-python-py'>opencl-in-python.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/opencl-in-python.py' name='opencl-in-python-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">OpenCL can be used to run code on GPUs and other</span>
<span class="sd">accelerators. It's a C API (kernel code looks like </span>
<span class="sd">C code) and pyopencl is a Python wrapper.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">pyopencl</span> <span class="k">as</span> <span class="nn">cl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="c1"># init opencl</span>
<span class="n">platform</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get_platforms</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">get_devices</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># AMD Radeon Pro 5500M Compute Engine</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Context</span><span class="p">([</span><span class="n">device</span><span class="p">])</span>
<span class="n">queue</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">CommandQueue</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

<span class="c1"># print(platform.get_info(cl.platform_info.NAME))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">platform_info</span><span class="o">.</span><span class="n">VERSION</span><span class="p">))</span>
<span class="c1"># OpenCL 1.2 (Mar  4 2023 12:44:39)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">device_info</span><span class="o">.</span><span class="n">NAME</span><span class="p">))</span>
<span class="c1"># AMD Radeon Pro 5500M Compute Engine</span>

<span class="c1"># init data</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">1000000000</span>

<span class="c1"># create arrays</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># opencl kernel</span>
<span class="n">kernel_code</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">__kernel void add(__global float *a, __global float *b, __global float *result, int size) {</span>
<span class="s2">    int idx = get_global_id(0);</span>
<span class="s2">    if (idx &lt; size) {</span>
<span class="s2">        result[idx] = a[idx] + b[idx];</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">"""</span>
<span class="c1"># compile kernel</span>
<span class="n">program</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Program</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">kernel_code</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># create buffers</span>
<span class="n">a_buffer</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">READ_ONLY</span> <span class="o">|</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">COPY_HOST_PTR</span><span class="p">,</span> <span class="n">hostbuf</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="n">b_buffer</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">READ_ONLY</span> <span class="o">|</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">COPY_HOST_PTR</span><span class="p">,</span> <span class="n">hostbuf</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">result_buffer</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">Buffer</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">cl</span><span class="o">.</span><span class="n">mem_flags</span><span class="o">.</span><span class="n">WRITE_ONLY</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">nbytes</span><span class="p">)</span>

<span class="c1"># opencl result</span>
<span class="k">def</span> <span class="nf">run_opencl</span><span class="p">():</span>
    <span class="c1"># execute kernel</span>
    <span class="n">program</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a_buffer</span><span class="p">,</span> <span class="n">b_buffer</span><span class="p">,</span> <span class="n">result_buffer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="c1"># copy result</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">enqueue_copy</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">result_buffer</span><span class="p">)</span>

<span class="c1"># numpy result to compare with</span>
<span class="n">numpy_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_numpy</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">numpy_result</span>
    <span class="n">numpy_result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'run_numpy'</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># 1.0561197996139526e-06</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="s1">'run_opencl'</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># 5.420297384262085e-07</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">numpy_result</span><span class="p">)</span>

<span class="c1"># free memory</span>
<span class="n">a_buffer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">b_buffer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">result_buffer</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="c1"># close opencl</span>
<span class="k">del</span> <span class="n">context</span>
<span class="k">del</span> <span class="n">queue</span>
<span class="k">del</span> <span class="n">program</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#operator-fusion-on-parse-tree-py'>operator-fusion-on-parse-tree.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/operator-fusion-on-parse-tree.py' name='operator-fusion-on-parse-tree-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Operator fusion is a technique to combine or rearrange</span>
<span class="sd">consecutive operations in a parse tree to improve</span>
<span class="sd">efficiency of code execution.</span>
<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">simplify_parse_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="c1"># first value in tuple, remaining values in tuple</span>
        <span class="n">operator</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">simplify_parse_tree</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">'+'</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">operands</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">'*'</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">'*'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">operands</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">tree</span>

<span class="c1"># (1 + 2) * (3 + 4)</span>
<span class="n">parse_tree</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'*'</span><span class="p">,</span> <span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">'+'</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">simplify_parse_tree</span><span class="p">(</span><span class="n">parse_tree</span><span class="p">))</span> <span class="c1"># 21</span>

<span class="n">compiled</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s1">'(1 + 2) * (3 + 4)'</span><span class="p">,</span> <span class="s1">'&lt;string&gt;'</span><span class="p">,</span> <span class="s1">'eval'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">compiled</span><span class="o">.</span><span class="n">co_consts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># 21</span>

<span class="k">assert</span> <span class="n">simplify_parse_tree</span><span class="p">(</span><span class="n">parse_tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">compiled</span><span class="o">.</span><span class="n">co_consts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#parallelization-optimization-py'>parallelization-optimization.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/parallelization-optimization.py' name='parallelization-optimization-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Parallelization optimization is a form of optimization</span>
<span class="sd">that aims to improve program performance by parallelizing</span>
<span class="sd">it, i.e. by splitting the program into smaller parts that</span>
<span class="sd">can be executed at the same time.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">timeit</span>

<span class="c1"># timeit.template = """</span>
<span class="c1"># def inner(_it, _timer{init}):</span>
<span class="c1">#     from tqdm import tqdm</span>
<span class="c1">#     {setup}</span>
<span class="c1">#     _t0 = _timer()</span>
<span class="c1">#     for _i in tqdm(_it, total=_it.__length_hint__()):</span>
<span class="c1">#         {stmt}</span>
<span class="c1">#     _t1 = _timer()</span>
<span class="c1">#     return _t1 - _t0</span>
<span class="c1"># """</span>

<span class="k">def</span> <span class="nf">sum_of_squares</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">num</span> <span class="o">*</span> <span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">sum_of_squares_parallel</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="c1"># use all available cores</span>
    <span class="n">num_processes</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_processes</span>
    <span class="c1"># create pool of processes</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">num_processes</span><span class="p">)</span>
    <span class="c1"># divide work into chunks</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">numbers</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">)]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sum_of_squares</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>
    <span class="c1"># close</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># combine results</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">sum_of_squares</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)))</span> <span class="o">==</span> <span class="n">sum_of_squares_parallel</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)))</span>
    <span class="c1"># timeit</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"sum_of_squares: </span><span class="si">{</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sum_of_squares</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># sum_of_squares: 7.48474136996083</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"sum_of_squares_parallel: </span><span class="si">{</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sum_of_squares_parallel</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># sum_of_squares_parallel: 6.641842097043991</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#shunting-yard-algorithm-py'>shunting-yard-algorithm.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/shunting-yard-algorithm.py' name='shunting-yard-algorithm-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/Shunting-yard_algorithm</span>
<span class="n">PRECEDENCE</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'func'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">'^'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'+'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input_</span><span class="p">):</span>
    <span class="n">operator</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">char</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># number</span>
        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="c1"># function</span>
        <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
            <span class="n">function</span> <span class="o">=</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                <span class="n">function</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">'func'</span><span class="p">,</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">function</span><span class="p">)))</span>
            <span class="c1"># advance</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># operator</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'+'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="s1">'^'</span><span class="p">]:</span>
            <span class="c1"># precedence</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'func'</span><span class="p">:</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'('</span><span class="p">,</span> <span class="s1">'^'</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span><span class="n">op</span> <span class="ow">in</span> <span class="n">PRECEDENCE</span> <span class="ow">and</span> <span class="n">PRECEDENCE</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">PRECEDENCE</span><span class="p">[</span><span class="n">char</span><span class="p">]):</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># break</span>
                    <span class="n">operator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                    <span class="k">break</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="c1"># left parenthesis</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">'('</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="c1"># right parenthesis</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">')'</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">'('</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operator</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Error: Mismatched parentheses"</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'func'</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">op</span> <span class="o">!=</span> <span class="s1">'('</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># pop operators</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">op</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'func'</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="k">return</span> <span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"3 + 4 * 2 / (1 - 5) ^2 ^3"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"3 4 2 * 1 5 - 2 3 ^ ^ / +"</span>
<span class="k">assert</span> <span class="n">parse</span><span class="p">(</span><span class="s2">"sin(max(2, 3) / 3 * pi)"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"2 3 max 3 / pi * sin"</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#tokenizer-using-generator-in-python-py'>tokenizer-using-generator-in-python.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/tokenizer-using-generator-in-python.py' name='tokenizer-using-generator-in-python-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="n">token_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'[a-zA-Z_][a-zA-Z0-9_]*|\d+|&lt;=|&gt;=|==|!=|[&lt;&gt;]=?|=|[+\-*/;()</span><span class="si">{}</span><span class="s1">]'</span>

<span class="n">tokens</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'if'</span><span class="p">:</span> <span class="s1">'IF'</span><span class="p">,</span>
    <span class="s1">'else'</span><span class="p">:</span> <span class="s1">'ELSE'</span><span class="p">,</span>
    <span class="s1">'number'</span><span class="p">:</span> <span class="s1">'NUM'</span><span class="p">,</span>
    <span class="s1">'identifier'</span><span class="p">:</span> <span class="s1">'ID'</span><span class="p">,</span>
    <span class="s1">'assignment'</span><span class="p">:</span> <span class="s1">'ASSIGN'</span><span class="p">,</span>
    <span class="s1">'operator'</span><span class="p">:</span> <span class="s1">'OP'</span><span class="p">,</span>
    <span class="s1">'unknown'</span><span class="p">:</span> <span class="s1">'?'</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># tokenize</span>
<span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">token_pattern</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="c1"># yield to return generator (lazy evaluation)</span>
        <span class="k">if</span> <span class="n">tokens</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>       <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="n">match</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>       <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s1">'number'</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">isidentifier</span><span class="p">():</span>  <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s1">'identifier'</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="ow">in</span> <span class="s1">'='</span><span class="p">:</span>          <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s1">'assignment'</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="ow">in</span> <span class="s1">'+-*/&lt;&gt;'</span><span class="p">:</span>     <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s1">'operator'</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="ow">in</span> <span class="s1">'()/{/};'</span><span class="p">:</span>    <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>                       <span class="k">yield</span> <span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="s1">'unknown'</span><span class="p">],</span> <span class="n">match</span><span class="p">)</span>

<span class="n">code</span> <span class="o">=</span> <span class="s2">"""if (x &lt; 10) { x = x + 1; }"""</span>

<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="c1"># ('IF', 'if')</span>
<span class="c1"># ('ID', 'x')</span>
<span class="c1"># ('OP', '&lt;')</span>
<span class="c1"># ('NUM', '10')</span>
<span class="c1"># ('ID', 'x')</span>
<span class="c1"># ('ASSIGN', '=')</span>
<span class="c1"># ('ID', 'x')</span>
<span class="c1"># ('OP', '+')</span>
<span class="c1"># ('NUM', '1')</span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#vectorization-optimization-py'>vectorization-optimization.py</a>[<a href='https://github.com/mxsjoberg/code/blob/master/python/compilers/vectorization-optimization.py' name='vectorization-optimization-py' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="sd">"""</span>
<span class="sd">Vectorization optimization is a technique for optimizing</span>
<span class="sd">programs by transforming sequential operations into</span>
<span class="sd">parallel operations (vector operations).</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">dis</span> <span class="kn">import</span> <span class="n">dis</span>

<span class="k">def</span> <span class="nf">add_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="c1"># vectorized</span>
<span class="k">def</span> <span class="nf">add_arrays_vectorized</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">add_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">==</span> <span class="n">add_arrays_vectorized</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="c1"># test data</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">add_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># 2.4067575628869236</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">add_arrays_vectorized</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">number</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="c1"># 0.07865401287563145</span>

<span class="n">dis</span><span class="p">(</span><span class="n">add_arrays</span><span class="p">)</span>
<span class="c1"># 4           0 RESUME                   0</span>

<span class="c1"># 5           2 BUILD_LIST               0</span>
<span class="c1">#             4 STORE_FAST               2 (result)</span>

<span class="c1"># 6           6 LOAD_GLOBAL              1 (NULL + range)</span>
<span class="c1">#            18 LOAD_GLOBAL              3 (NULL + len)</span>
<span class="c1">#            30 LOAD_FAST                0 (a)</span>
<span class="c1">#            32 PRECALL                  1</span>
<span class="c1">#            36 CALL                     1</span>
<span class="c1">#            46 PRECALL                  1</span>
<span class="c1">#            50 CALL                     1</span>
<span class="c1">#            60 GET_ITER</span>
<span class="c1">#       &gt;&gt;   62 FOR_ITER                38 (to 140)</span>
<span class="c1">#            64 STORE_FAST               3 (i)</span>

<span class="c1"># 7          66 LOAD_FAST                2 (result)</span>
<span class="c1">#            68 LOAD_METHOD              2 (append)</span>
<span class="c1">#            90 LOAD_FAST                0 (a)</span>
<span class="c1">#            92 LOAD_FAST                3 (i)</span>
<span class="c1">#            94 BINARY_SUBSCR</span>
<span class="c1">#           104 LOAD_FAST                1 (b)</span>
<span class="c1">#           106 LOAD_FAST                3 (i)</span>
<span class="c1">#           108 BINARY_SUBSCR</span>
<span class="c1">#           118 BINARY_OP                0 (+)</span>
<span class="c1">#           122 PRECALL                  1</span>
<span class="c1">#           126 CALL                     1</span>
<span class="c1">#           136 POP_TOP</span>
<span class="c1">#           138 JUMP_BACKWARD           39 (to 62)</span>

<span class="c1"># 8     &gt;&gt;  140 LOAD_FAST                2 (result)</span>
<span class="c1">#           142 RETURN_VALUE</span>

<span class="n">dis</span><span class="p">(</span><span class="n">add_arrays_vectorized</span><span class="p">)</span>
<span class="c1"># 11           0 RESUME                   0</span>

<span class="c1"># 12           2 LOAD_GLOBAL              1 (NULL + np)</span>
<span class="c1">#             14 LOAD_ATTR                1 (array)</span>
<span class="c1">#             24 LOAD_FAST                0 (a)</span>
<span class="c1">#             26 PRECALL                  1</span>
<span class="c1">#             30 CALL                     1</span>
<span class="c1">#             40 LOAD_GLOBAL              1 (NULL + np)</span>
<span class="c1">#             52 LOAD_ATTR                1 (array)</span>
<span class="c1">#             62 LOAD_FAST                1 (b)</span>
<span class="c1">#             64 PRECALL                  1</span>
<span class="c1">#             68 CALL                     1</span>
<span class="c1">#             78 BINARY_OP                0 (+)</span>
<span class="c1">#             82 RETURN_VALUE</span>
</pre></div>
</div></div></div></div></div><div class='row'><hr></div><div class='row'><div class='col-12'><a name='assembly'></a><h1>assembly<a class='dotted' href='#assembly-x86'>x86</a><a class='dotted float-right' href='#top'>^</a></h1><a name='assembly-x86'></a><h2>x86<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#hello-x86-asm'>hello-x86.asm</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#hello-x86-asm'>hello-x86.asm</a>[<a href='https://github.com/mxsjoberg/code/blob/master/assembly/x86/hello-x86.asm' name='hello-x86-asm' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1">; x86-64 (intel syntax)</span>
<span class="w">    </span><span class="nf">section</span><span class="w"> </span><span class="no">.text</span><span class="w"></span>
<span class="w">    </span><span class="nf">global</span><span class="w"> </span><span class="no">_main</span><span class="w"></span>

<span class="nl">_main:</span><span class="w"></span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0x02000004</span><span class="w">     </span><span class="c1">; write (4)</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="c1">; stdout</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="no">message</span><span class="w">        </span><span class="c1">; address of output</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w">             </span><span class="c1">; bytes : "hello x86" + /n = 10</span>
<span class="w">    </span><span class="nf">syscall</span><span class="w">                 </span><span class="c1">; invoke write</span>
<span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0x02000001</span><span class="w">     </span><span class="c1">; exit (1)</span>
<span class="w">    </span><span class="nf">xor</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="no">rdi</span><span class="w">            </span><span class="c1">; 0</span>
<span class="w">    </span><span class="nf">syscall</span><span class="w">                 </span><span class="c1">; invoke to exit</span>

<span class="w">    </span><span class="nf">section</span><span class="w"> </span><span class="no">.data</span><span class="w"></span>

<span class="nl">message:</span><span class="w"></span>
<span class="w">    </span><span class="nf">db</span><span class="w"> </span><span class="err">"</span><span class="no">hello</span><span class="w"> </span><span class="no">x86</span><span class="err">"</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="w">      </span><span class="c1">; define byte : text, \n (10)</span>

<span class="c1">; $ nasm -f macho64 hello-x86.asm </span>
<span class="c1">; $ ld hello-x86.o -o _hello -lSystem -L/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/lib</span>
<span class="c1">; $ ./_hello</span>
<span class="c1">; hello x86</span>
</pre></div>
</div></div></div></div></div><div class='row'><hr></div><div class='row'><div class='col-12'><a name='verilog'></a><h1>verilog<a class='dotted' href='#verilog-misc'>misc</a><a class='dotted' href='#verilog-gates'>gates</a><a class='dotted float-right' href='#top'>^</a></h1><a name='verilog-misc'></a><h2>misc<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#intro-v'>intro.v</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#intro-v'>intro.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/misc/intro.v' name='intro-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    http://www.techep.csi.cuny.edu/~zhangs/v.html</span>
<span class="cm">    iverilog -o intro intro.v; vvp intro</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// module &lt; filename &gt; (&lt; ports &gt;)</span>
<span class="k">module</span><span class="w"> </span><span class="n">intro</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span>
<span class="w">    </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// $display : only useful for debugging</span>
<span class="w">        </span><span class="nb">$display</span><span class="p">(</span><span class="s">"hello verilog"</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="nb">$finish</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div></div></div><a name='verilog-gates'></a><h2>gates<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#and16-v'>and16.v</a><a class='dotted' href='#and-v'>and.v</a><a class='dotted' href='#dmux4way-v'>dmux4way.v</a><a class='dotted' href='#dmux8way-v'>dmux8way.v</a><a class='dotted' href='#dmux-v'>dmux.v</a><a class='dotted' href='#mux4way16-v'>mux4way16.v</a><a class='dotted' href='#mux8way16-v'>mux8way16.v</a><a class='dotted' href='#mux16-v'>mux16.v</a><a class='dotted' href='#mux-v'>mux.v</a><a class='dotted' href='#nand-v'>nand.v</a><a class='dotted' href='#not16-v'>not16.v</a><a class='dotted' href='#not-v'>not.v</a><a class='dotted' href='#or8way-v'>or8way.v</a><a class='dotted' href='#or16-v'>or16.v</a><a class='dotted' href='#or-v'>or.v</a><a class='dotted' href='#xor-v'>xor.v</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#and16-v'>and16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/and16.v' name='and16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    And16(a, b) : For i = 0..15 out[i] = And(a[i], b[i])</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">and16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">and16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// and16_gate Instance0 (out, a, b);</span>
<span class="w">    </span><span class="n">and16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w">     </span><span class="c1">// 1, 1, 1, 1, 1, 1, 1, 1</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0, 0, 0, 0, 0, 0, 0, 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">//  0 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  1 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  2 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  3 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  4 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  5 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  6 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  7 | a = 1 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">//  8 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  9 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 10 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 11 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 12 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 13 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 14 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 15 | a = 0 | b = 1 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#and-v'>and.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/and.v' name='and-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    And(a, b) : If a = b = 1 then out = 1 else out = 0</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">and_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations (note: limited to nand-gates)</span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">and_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (_nand_test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 1 | a = 0 | b = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 1 | out = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#dmux4way-v'>dmux4way.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/dmux4way.v' name='dmux4way-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    DMux4way(in, sel) :</span>
<span class="cm">        If sel = 00 then { a = in, b = c = d = 0 } else if</span>
<span class="cm">           sel = 01 then { b = in, a = c = d = 0 } else if</span>
<span class="cm">           sel = 10 then { c = in, a = b = d = 0 } else if</span>
<span class="cm">           sel = 11 then { d = in, a = b = c = 0 }</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// dmux.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux4way_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux4way_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 2'b : 2-bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b00</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b10</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b01</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// dmux4way_gate Instance0 (a, b, c, d, in, sel);</span>
<span class="w">    </span><span class="n">dmux4way_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { a = 1, b = c = d = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { b = 1, a = c = d = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { c = 1, a = b = d = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { d = 1, a = b = c = 0 }</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | in = %d | sel = [%d, %d] | a = %d | b = %d | c = %d | d = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | in = 1 | sel = [0, 0] | a = 1 | b = 0 | c = 0 | d = 0</span>
<span class="w">        </span><span class="c1">// 1 | in = 1 | sel = [0, 1] | a = 0 | b = 1 | c = 0 | d = 0</span>
<span class="w">        </span><span class="c1">// 2 | in = 1 | sel = [1, 0] | a = 0 | b = 0 | c = 1 | d = 0</span>
<span class="w">        </span><span class="c1">// 3 | in = 1 | sel = [1, 1] | a = 0 | b = 0 | c = 0 | d = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#dmux8way-v'>dmux8way.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/dmux8way.v' name='dmux8way-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    DMux8way(in, sel) :</span>
<span class="cm">        If sel = 000 then { a = in, b = c = d = e = f = g = h = 0 } else if</span>
<span class="cm">           sel = 001 then { b = in, a = c = d = e = f = g = h = 0 } else if</span>
<span class="cm">           sel = 010 then { c = in, a = b = d = e = f = g = h = 0 } else if</span>
<span class="cm">           sel = 011 then { d = in, a = b = c = e = f = g = h = 0 } else if</span>
<span class="cm">           sel = 100 then { e = in, a = b = c = d = f = g = h = 0 } else if</span>
<span class="cm">           sel = 101 then { f = in, a = b = c = d = e = g = h = 0 } else if</span>
<span class="cm">           sel = 110 then { g = in, a = b = c = d = e = f = h = 0 } else if</span>
<span class="cm">           sel = 111 then { h = in, a = b = c = d = e = f = g = 0 }</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// dmux.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux8way_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">,</span><span class="w"> </span><span class="n">aoo</span><span class="p">,</span><span class="w"> </span><span class="n">boo</span><span class="p">,</span><span class="w"> </span><span class="n">coo</span><span class="p">,</span><span class="w"> </span><span class="n">doo</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">aoo</span><span class="p">,</span><span class="w"> </span><span class="n">boo</span><span class="p">,</span><span class="w"> </span><span class="n">ao</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">coo</span><span class="p">,</span><span class="w"> </span><span class="n">doo</span><span class="p">,</span><span class="w"> </span><span class="n">bo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance3</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">aoo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance4</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">boo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance5</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">coo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">dmux_gate</span><span class="w"> </span><span class="n">Instance6</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">doo</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux8way_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 3'b : 3 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b000</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b100</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b010</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b110</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b001</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b101</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b011</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// dmux8way_gate Instance0 (a, b, c, d, e, f, g, h, in, sel);</span>
<span class="w">    </span><span class="n">dmux8way_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { a = 1, b = c = d = e = f = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { b = 1, a = c = d = e = f = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { c = 1, a = b = d = e = f = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { d = 1, a = b = c = e = f = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { e = 1, a = b = c = d = f = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { f = 1, a = b = c = d = e = g = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// { g = 1, a = b = c = d = e = f = h = 0 }</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// { h = 1, a = b = c = d = e = f = g = 0 }</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | in = %d | sel = [%d, %d, %d] | a = %d | b = %d | c = %d | d = %d | e = %d | f = %d | g = %d | h = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | in = 1 | sel = [0, 0, 0] | a = 1 | b = 0 | c = 0 | d = 0 | e = 0 | f = 0 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 1 | in = 1 | sel = [0, 0, 1] | a = 0 | b = 1 | c = 0 | d = 0 | e = 0 | f = 0 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 2 | in = 1 | sel = [0, 1, 0] | a = 0 | b = 0 | c = 1 | d = 0 | e = 0 | f = 0 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 3 | in = 1 | sel = [0, 1, 1] | a = 0 | b = 0 | c = 0 | d = 1 | e = 0 | f = 0 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 4 | in = 1 | sel = [1, 0, 0] | a = 0 | b = 0 | c = 0 | d = 0 | e = 1 | f = 0 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 5 | in = 1 | sel = [1, 0, 1] | a = 0 | b = 0 | c = 0 | d = 0 | e = 0 | f = 1 | g = 0 | h = 0</span>
<span class="w">        </span><span class="c1">// 6 | in = 1 | sel = [1, 1, 0] | a = 0 | b = 0 | c = 0 | d = 0 | e = 0 | f = 0 | g = 1 | h = 0</span>
<span class="w">        </span><span class="c1">// 7 | in = 1 | sel = [1, 1, 1] | a = 0 | b = 0 | c = 0 | d = 0 | e = 0 | f = 0 | g = 0 | h = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#dmux-v'>dmux.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/dmux.v' name='dmux-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    DMux(in, sel) : If sel = 0 then { a = in, b = 0 } else { a = 0, b = in }</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">dmux_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 1'b : 1 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// dmux_gate Instance0 (a, b, in, sel);</span>
<span class="w">    </span><span class="n">dmux_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0, 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1, 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0, 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0, 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | in = %d | sel = %d | a = %d | b = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | in = 0 | sel = 0 | a = 0 | b = 0</span>
<span class="w">        </span><span class="c1">// 1 | in = 1 | sel = 0 | a = 1 | b = 0</span>
<span class="w">        </span><span class="c1">// 2 | in = 0 | sel = 1 | a = 0 | b = 0</span>
<span class="w">        </span><span class="c1">// 3 | in = 1 | sel = 1 | a = 0 | b = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#mux4way16-v'>mux4way16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/mux4way16.v' name='mux4way16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Mux4Way16(a, b, c, d, sel) :</span>
<span class="cm">        If sel = 00 then out = a else if</span>
<span class="cm">           sel = 01 then out = b else if</span>
<span class="cm">           sel = 10 then out = c else if</span>
<span class="cm">           sel = 11 then out = d</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// mux.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// mux16.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance3</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance4</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance5</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance6</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance7</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance8</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance9</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance10</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance11</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance12</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance13</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance14</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance15</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux4way16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">cd</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">cd</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">cd</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux4way16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 2'b : 2 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b00</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b10</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">2</span><span class="mb">'b01</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// mux4way16_gate Instance0 (out, a, b, c, d, sel);</span>
<span class="w">    </span><span class="n">mux4way16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = a = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = b = 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = c = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = d = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | c = %d | d = %d | sel = [%d, %d] | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 1 | b = 0 | c = 1 | d = 0 | sel = [0, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | a = 1 | b = 0 | c = 1 | d = 0 | sel = [0, 1] | out = 0</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | c = 1 | d = 0 | sel = [1, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 0 | c = 1 | d = 0 | sel = [1, 1] | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#mux8way16-v'>mux8way16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/mux8way16.v' name='mux8way16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Mux8Way16(a, b, c, d, e, f, g, h, sel) :</span>
<span class="cm">        If sel = 000 then out = a else if</span>
<span class="cm">           sel = 001 then out = b else if</span>
<span class="cm">           sel = 010 then out = c else if</span>
<span class="cm">           sel = 011 then out = d else if</span>
<span class="cm">           sel = 100 then out = e else if </span>
<span class="cm">           sel = 101 then out = f else if </span>
<span class="cm">           sel = 110 then out = g else if</span>
<span class="cm">           sel = 111 then out = h</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// mux.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// mux16.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance3</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance4</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance5</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance6</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance7</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance8</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance9</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance10</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance11</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance12</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance13</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance14</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance15</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux8way16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">cd</span><span class="p">,</span><span class="w"> </span><span class="n">ef</span><span class="p">,</span><span class="w"> </span><span class="n">gh</span><span class="p">,</span><span class="w"> </span><span class="n">abcd</span><span class="p">,</span><span class="w"> </span><span class="n">efgh</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">cd</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">ef</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance3</span><span class="w"> </span><span class="p">(</span><span class="n">gh</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance4</span><span class="w"> </span><span class="p">(</span><span class="n">abcd</span><span class="p">,</span><span class="w"> </span><span class="n">ab</span><span class="p">,</span><span class="w"> </span><span class="n">cd</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance5</span><span class="w"> </span><span class="p">(</span><span class="n">efgh</span><span class="p">,</span><span class="w"> </span><span class="n">ef</span><span class="p">,</span><span class="w"> </span><span class="n">gh</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>

<span class="w">    </span><span class="n">mux16_gate</span><span class="w"> </span><span class="n">Instance6</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">abcd</span><span class="p">,</span><span class="w"> </span><span class="n">efgh</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux8way16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 3'b : 3 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b000</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b100</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b010</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b110</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b001</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b101</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">3</span><span class="mb">'b011</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// mux8way16_gate Instance0 (out, a, b, c, d, e, f, g, h, sel);</span>
<span class="w">    </span><span class="n">mux8way16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">c</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">d</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">e</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">f</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">g</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">h</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = a = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = b = 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = c = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = d = 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = e = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = f = 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = g = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = h = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | c = %d | d = %d | e = %d | f = %d | g = %d | h = %d | sel = [%d, %d, %d] | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">d</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">e</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">g</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">h</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [0, 0, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [0, 0, 1] | out = 0</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [0, 1, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [0, 1, 1] | out = 0</span>
<span class="w">        </span><span class="c1">// 4 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [1, 0, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 5 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [1, 0, 1] | out = 0</span>
<span class="w">        </span><span class="c1">// 6 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [1, 1, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 7 | a = 1 | b = 0 | c = 1 | d = 0 | e = 1 | f = 0 | g = 1 | h = 0 | sel = [1, 1, 1] | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#mux16-v'>mux16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/mux16.v' name='mux16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Mux16(a, b, sel) : If sel = 0 then for i = 0..15 out[i] = a[i] else for i = 0..15 out[i] = b[i]</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// mux.v</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance1</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance2</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance3</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance4</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance5</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance6</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance7</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance8</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance9</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance10</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance11</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance12</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance13</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance14</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">mux_gate</span><span class="w"> </span><span class="n">Instance15</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 1'b : 1 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// mux16_gate Instance0 (out, a, b, sel);</span>
<span class="w">    </span><span class="n">mux16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | sel = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">sel</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 1 | b = 0 | sel = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | a = 1 | b = 0 | sel = 1 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#mux-v'>mux.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/mux.v' name='mux-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Mux(a, b, sel) : If sel = 0 then out = a else out = b</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notsel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notsel</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">notsel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">mux_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">sel</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 1'b : 1 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// mux_gate Instance0 (out, a, b, sel);</span>
<span class="w">    </span><span class="n">mux_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | a = %d | b = %d | sel = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">sel</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 0 | b = 0 | sel = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 1 | a = 0 | b = 1 | sel = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | sel = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 1 | sel = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 4 | a = 0 | b = 0 | sel = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 5 | a = 0 | b = 1 | sel = 1 | out = 1</span>
<span class="w">        </span><span class="c1">// 6 | a = 1 | b = 0 | sel = 1 | out = 0</span>
<span class="w">        </span><span class="c1">// 7 | a = 1 | b = 1 | sel = 1 | out = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#nand-v'>nand.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/nand.v' name='nand-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Nand(a, b) : If a = b = 1 then out = 0 else out = 1</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">nand_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">nand_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 1'b : 1 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// nand_gate Instance0 (out, a, b);</span>
<span class="w">    </span><span class="n">nand_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (_nand_test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 0 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | a = 0 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 1 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#not16-v'>not16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/not16.v' name='not16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Not16(in) : For i = 0..15 out[i] = Not(in[i])</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">not16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">not16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// not16_gate Instance0 (out, in);</span>
<span class="w">    </span><span class="n">not16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0, 0, 0, 0, 0, 0, 0, 0</span>
<span class="w">        </span><span class="n">in</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1, 1, 1, 1, 1, 1, 1, 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">//  0 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  1 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  2 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  3 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  4 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  5 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  6 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  7 | in = 1 | out = 0</span>
<span class="w">        </span><span class="c1">//  8 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  9 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 10 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 11 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 12 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 13 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 14 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 15 | in = 0 | out = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#not-v'>not.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/not.v' name='not-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Not(in) : If in = 0 then out = 1 else out = 0</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">not_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations (note: limited to nand-gates)</span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">not_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (_nand_test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | in = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | in = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | in = 1 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#or8way-v'>or8way.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/or8way.v' name='or8way-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Or8Way(in) : out = Or(in[0], ..., in[7])</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">or8way_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations : or</span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">or8way_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// or8way_gate Instance0 (out, in);</span>
<span class="w">    </span><span class="n">or8way_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (_nand_test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | in = [%d, %d, %d, %d, %d, %d, %d, %d] | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | in = [1, 0, 1, 0, 1, 0, 1, 0] | out = 1</span>
<span class="w">        </span><span class="c1">// 1 | in = [0, 0, 0, 0, 0, 0, 0, 0] | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#or16-v'>or16.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/or16.v' name='or16-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Or16(a, b) : For i = 0..15 out[i] = Or(a[i], b[i])</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">or16_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">or16_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// or16_gate Instance0 (out, a, b);</span>
<span class="w">    </span><span class="n">or16_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b11111111</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w">     </span><span class="c1">// 1, 1, 1, 1, 1, 1, 1, 1</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">8</span><span class="mb">'b00000000</span><span class="p">;</span><span class="w">   </span><span class="c1">// 0, 0, 0, 0, 0, 0, 0, 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">3</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">4</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">4</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">5</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">5</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">6</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">6</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">7</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">7</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">8</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">8</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">9</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">9</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">10</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">10</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">11</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">11</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">12</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">12</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">13</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">13</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">14</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">14</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%2d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mh">15</span><span class="p">],</span><span class="w"> </span><span class="n">out</span><span class="p">[</span><span class="mh">15</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="c1">//  0 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  1 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  2 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  3 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  4 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  5 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  6 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  7 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">//  8 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">//  9 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 10 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 11 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 12 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 13 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 14 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 15 | a = 0 | b = 0 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#or-v'>or.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/or.v' name='or-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Or(a, b) : If a = b = 0 then out = 0 else out = 1</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">or_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations (note: limited to nand-gates)</span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">nand</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">or_gate</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// out = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (_nand_test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 1 | a = 0 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 1 | out = 1</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#xor-v'>xor.v</a>[<a href='https://github.com/mxsjoberg/code/blob/master/verilog/gates/xor.v' name='xor-v' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">    Xor(a, b) : If a&lt;&gt;b then out = 1 else out = 0</span>
<span class="cm">*/</span><span class="w"></span>

<span class="c1">// gate-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">xor_gate</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// wire : internal pin</span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">w2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">nota</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">notb</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// operations</span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">nota</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">not</span><span class="p">(</span><span class="n">notb</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">notb</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="p">(</span><span class="n">w2</span><span class="p">,</span><span class="w"> </span><span class="n">nota</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">or</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">w1</span><span class="p">,</span><span class="w"> </span><span class="n">w2</span><span class="p">);</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// behavioural-level</span>
<span class="k">module</span><span class="w"> </span><span class="n">xor_behavioural</span><span class="w"> </span><span class="p">(</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">always</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="c1">// note: 1'b : 1 bit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">))</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">            </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="mb">'b0</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>

<span class="c1">// test</span>
<span class="k">module</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">reg</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">wire</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// xor_gate Instance0 (out, a, b);</span>
<span class="w">    </span><span class="n">xor_behavioural</span><span class="w"> </span><span class="n">Instance0</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// note: #(n) : delay by n timestep (check time scale with $printtimescale)</span>
<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="p">#(</span><span class="mh">0</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
<span class="w">        </span><span class="p">#(</span><span class="mh">1</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">initial</span><span class="w"> </span><span class="k">begin</span><span class="w"></span>
<span class="w">        </span><span class="nb">$printtimescale</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Time scale of (test) is 1s / 1s</span>
<span class="w">        </span><span class="nb">$monitor</span><span class="w"> </span><span class="p">(</span><span class="s">"%1d | a = %d | b = %d | out = %d"</span><span class="p">,</span><span class="w"> </span><span class="nb">$time</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// 0 | a = 0 | b = 0 | out = 0</span>
<span class="w">        </span><span class="c1">// 1 | a = 0 | b = 1 | out = 1</span>
<span class="w">        </span><span class="c1">// 2 | a = 1 | b = 0 | out = 1</span>
<span class="w">        </span><span class="c1">// 3 | a = 1 | b = 1 | out = 0</span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">endmodule</span><span class="w"></span>
</pre></div>
</div></div></div></div></div><div class='row'><hr></div><div class='row'><div class='col-12'><a name='c'></a><h1>c<a class='dotted' href='#c-misc'>misc</a><a class='dotted float-right' href='#top'>^</a></h1><a name='c-misc'></a><h2>misc<a class='dotted float-right' href='#top'>^</a></h2><p><a class='dotted' href='#header-files-c'>header-files.c</a><a class='dotted' href='#linked-list-c'>linked-list.c</a><a class='dotted' href='#macros-c'>macros.c</a><a class='dotted' href='#memory-c'>memory.c</a><a class='dotted' href='#pointers-c'>pointers.c</a><a class='dotted' href='#valist-c'>valist.c</a></p><div class='container-fluid p-0'><div class='row wrapper'><div class='col-12 box'><a class='dotted' href='#header-files-c'>header-files.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/header-files.c' name='header-files-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="c1">// filename.h</span>
<span class="cm">/*</span>
<span class="cm">    #ifndef FILENAME_H</span>
<span class="cm">    #define FILENAME_H</span>

<span class="cm">    const int number = 10;</span>

<span class="cm">    #endif</span>
<span class="cm">*/</span><span class="w"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">"filename.h"</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#linked-list-c'>linked-list.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/linked-list.c' name='linked-list-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="c1">// linked list implementation in C</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="c1">// element is struct with a value and a pointer to the next element</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="c1">// allocate memory for element</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">create_element</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="n">element</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">element</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">element</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// insert</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ll_insert</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">**</span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">new_element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_element</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// list is empty</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">element</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">*</span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_element</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// list is not empty</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">element</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// iterate until last element</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="c1">// insert new element</span>
<span class="w">        </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_element</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// remove</span>
<span class="kt">void</span><span class="w"> </span><span class="n">ll_remove</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">**</span><span class="n">element</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">element</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// iterate until last element</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// value is found</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// value is first element</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">previous</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="o">*</span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="c1">// value is not first element</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">previous</span><span class="o">-&gt;</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="c1">// free memory</span>
<span class="w">            </span><span class="n">free</span><span class="p">(</span><span class="n">current</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="c1">// update pointers</span>
<span class="w">        </span><span class="n">previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// print</span>
<span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// iterate until last element</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">current</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">Element</span><span class="w"> </span><span class="o">*</span><span class="n">ll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// insert</span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">ll</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5 10 15 20 25 30</span>

<span class="w">    </span><span class="c1">// remove</span>
<span class="w">    </span><span class="n">ll_remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">ll_remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ll</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">ll</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5 10 20 25</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#macros-c'>macros.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/macros.c' name='macros-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>

<span class="c1">// stringify error messages</span>
<span class="cp">#define  error_message(error) \</span>
<span class="cp">   printf("error: " #error "\n")</span>

<span class="c1">// if not defined (used in header files to avoid multiple inclusion)</span>
<span class="cp">#ifndef MESSAGE</span>
<span class="cp">#define MESSAGE "This is the message if not already defined."</span>
<span class="cp">#endif</span>

<span class="c1">// parameterized macros</span>
<span class="cp">#define square(x) ((x) * (x))</span>
<span class="cp">#define max(x, y) ((x) &gt; (y) ? (x) : (y))</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">__FILE__</span><span class="p">);</span><span class="w"> </span><span class="c1">// macros.c</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">__DATE__</span><span class="p">);</span><span class="w"> </span><span class="c1">// Aug 21 2019</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">__TIME__</span><span class="p">);</span><span class="w"> </span><span class="c1">// 01:22:18</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">__LINE__</span><span class="p">);</span><span class="w"> </span><span class="c1">// 12</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">__STDC__</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>

<span class="w">   </span><span class="n">error_message</span><span class="p">(</span><span class="s">"This is an error."</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">// error: "This is an error."</span>

<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">MESSAGE</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="c1">// This is the message if not already defined.</span>

<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">square</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="c1">// 4</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span><span class="w"> </span><span class="c1">// 5</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#memory-c'>memory.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/memory.c' name='memory-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm">    - allocate an array of n elements of size s</span>
<span class="cm">        void *calloc(int n, int s);</span>

<span class="cm">    - release a block of memory at address</span>
<span class="cm">        void free(void *address);</span>

<span class="cm">    - allocate an array of b bytes (uninitialised)</span>
<span class="cm">        void *malloc(int b);</span>

<span class="cm">    - re-allocate memory at address (extending to new size s)</span>
<span class="cm">        void *realloc(void *address, int s);</span>
<span class="cm">*/</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">name</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">description</span><span class="p">;</span><span class="w"> </span><span class="c1">// pointer to char without size limit</span>

<span class="w">    </span><span class="c1">// copy string of 35 bytes into buffer of 36 bytes</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">"Wolfeschlegelsteinhausenbergerdorff"</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// allocate memory dynamically (can result in fragmented memory)</span>
<span class="w">    </span><span class="c1">// description = malloc(10 * sizeof(char));</span>
<span class="w">    </span><span class="c1">// strcpy(description, "A too long text to store in only 10 bytes...");</span>
<span class="w">    </span><span class="c1">// printf("%s\n", description);</span>
<span class="w">    </span><span class="c1">// malloc(): corrupted top size</span>
<span class="w">    </span><span class="c1">// Aborted</span>

<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="s">"A too long text to store in only 10 bytes..."</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// A too long text to store in only 10 bytes...</span>

<span class="w">    </span><span class="c1">// free memory</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">description</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#pointers-c'>pointers.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/pointers.c' name='pointers-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w"> </span><span class="c1">// null pointer</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">ip</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0x0 (nil)</span>

<span class="w">    </span><span class="c1">// point to address of num</span>
<span class="w">    </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0x7ffdb78c2664</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">ip</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0x7ffdb78c2664</span>

<span class="w">    </span><span class="c1">// dereference (get value at address)</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ip</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div><div class='col-12 box'><a class='dotted' href='#valist-c'>valist.c</a>[<a href='https://github.com/mxsjoberg/code/blob/master/c/misc/valist.c' name='valist-c' class='m-0'>github</a>]<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdarg.h&gt;</span><span class="cp"></span>

<span class="c1">// declare function (normally in header file)</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">average</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span><span class="w"></span>
<span class="c1">// define function</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">average</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">va_list</span><span class="w"> </span><span class="n">valist</span><span class="p">;</span><span class="w"> </span><span class="cm">/* stdarg.h */</span><span class="w"></span>
<span class="w">    </span><span class="c1">// return value</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// init valist for n arguments</span>
<span class="w">    </span><span class="n">va_start</span><span class="p">(</span><span class="n">valist</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// access arguments</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">va_arg</span><span class="p">(</span><span class="n">valist</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// free memory</span>
<span class="w">    </span><span class="n">va_end</span><span class="p">(</span><span class="n">valist</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// success</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"average of {1,2,3,4,5}: %f</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">average</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="c1">// average of {1,2,3,4,5}: 3.000000</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div></div></div></div></div></div>